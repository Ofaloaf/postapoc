###########################################
#                                         #
# M&M Monastic Orders Events              #
#                                         #
# ID SUFI.4000-SUFI.4999		          #
#                                         #
###########################################

namespace = SUFI

#### MANAGEMENT ####
#Title Overhaul Management
character_event = {
	id = SUFI.908
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = the_sufi_schools_active }
	}
	
	immediate = {
		set_global_flag = the_sufi_schools_active #for crossmod stuff
		# if = {
			# limit = {
				# any_playable_ruler = { culture = hedgehog_culture }
			# }
			# set_global_flag = chivalry_animals_kingdom_active #animals_kingdom
		# }
		# if = { #Ancient religion
			# limit = {
				# has_global_flag = ancrel
			# }
			# set_global_flag = ANCREL_ACTIVE
		# }
		if = { #HIP
			# limit = {
				# has_character_flag = start_of_game_character
			# }
			# set_global_flag = CK2PLUS_ACTIVE
		# }
		# else_if = { #CK2+
			limit = {
				OR = {
					has_global_flag = EMF
					has_global_flag = SWMH
				}
			}
			set_global_flag = HIPEMF_ACTIVE
		}
		# else_if = { #ElderKIngs
			# limit = {
				# OR = {
					# has_global_flag = mages_tamriel_necromancy_allowed
					# has_global_flag = mages_tamriel_necromancy_banned
				# }
			# }
			# set_global_flag = ELDERKINGS_ACTIVE
		# }
		else = {
			character_event = { id = SUFI.9081 days = 1 }
		}
	}
}

#Title Overhaul Management Ping
character_event = {
	id = SUFI.9081
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		# if = { #Ancient religion
			# limit = {
				# has_global_flag = ancrel
			# }
			# set_global_flag = ANCREL_ACTIVE
		# }
		if = { #HIP
			# limit = {
				# has_character_flag = start_of_game_character
			# }
			# set_global_flag = CK2PLUS_ACTIVE
		# }
		# else_if = { #CK2+
			limit = {
				OR = {
					has_global_flag = EMF
					has_global_flag = SWMH
				}
			}
			set_global_flag = HIPEMF_ACTIVE
		}
		# else_if = { #ElderKIngs
			# limit = {
				# OR = {
					# has_global_flag = mages_tamriel_necromancy_allowed
					# has_global_flag = mages_tamriel_necromancy_banned
				# }
			# }
			# set_global_flag = ELDERKINGS_ACTIVE
		# }
		# else = { }
	}
}



###JOINING###

#From on_character_ask_to_join_society
character_event = {
    id = SUFI.4450
	hide_window = yes
    is_triggered_only = yes
    trigger = {
    	FROM = { leader = { is_sufi_member_trigger = yes } }
    }
    immediate = {
    	FROM = { leader = { character_event = { id = SUFI.4451 } } }
    }
}

#Ping event
character_event = {
    id = SUFI.4451
	hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = SUFI.4452 } }
    }
}

#Welcome letter
letter_event = {
    id = SUFI.4452
    desc = EVTDESC_SUFI_4452
    border = GFX_event_letter_frame_religion

    is_triggered_only = yes
	
	immediate = { set_character_flag = society_join_block }
	
    option = { 
        name = EVTOPTA_SUFI_44511

        FROM = { ROOT = { join_prev_sufi_order_society = yes } }
		
		scaled_wealth = -0.25
		
		clr_character_flag = society_join_block
    }
}

#Title Overhaul Management Ping
character_event = {
	id = SUFI.108
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = CK2PLUS_ACTIVE }
		NOT = { has_global_flag = HIPEMF_ACTIVE }
	}
	
	immediate = {
		if = { #HIP
			limit = {
				has_character_flag = start_of_game_character
			}
			set_global_flag = CK2PLUS_ACTIVE
		}
		else_if = { #CK2+
			limit = {
				OR = {
					has_global_flag = EMF
					has_global_flag = SWMH
				}
			}
			set_global_flag = HIPEMF_ACTIVE
		}
		else = {
			character_event = { id = SUFI.1081 days = 1 }
		}
	}
}

#Title Overhaul Management
character_event = {
	id = SUFI.1081
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = { #HIP
			limit = {
				has_character_flag = start_of_game_character
			}
			set_global_flag = CK2PLUS_ACTIVE
		}
		else_if = { #CK2+
			limit = {
				OR = {
					has_global_flag = EMF
					has_global_flag = SWMH
				}
			}
			set_global_flag = HIPEMF_ACTIVE
		}
		else = { }
	}
}

###RANKING UP EVENTS####

# Hidden start: Send the rank-up request to the current Grandmaster (delayed event on self, from decision to rank up)
character_event = {
	id = SUFI.10002

	hide_window = yes

	trigger = {
		has_character_flag = has_sent_request_to_rank_up
	}
	
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { is_in_society = yes }
			random_society_member = {
				limit = {
					is_society_grandmaster = yes
					same_society_as = ROOT
				}
				character_event = { id = SUFI.10000 } # send request to Grand Master. Relic rewards also handled by this event
			}
		}
		if = {
			limit = { is_in_society = no }
			clr_character_flag = has_sent_request_to_rank_up
		}
	}
}

# Grandmaster gets the rank-up request
character_event = {
	id = SUFI.10000
	
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		event_target:rank_up_target = { letter_event = { id = SUFI.10001 } }
		FROM = {
			if = {
				limit = {
					society_rank == 2
				}
				
				random = {
					chance = 20
					modifier = {
						ai = no
						factor = 5
					}
					letter_event = { id = SUFI.4431 days = 30 random = 15 } #Gives mantle water
				}
			}
		}
	}
}

#Grand master approves my request
letter_event = {
	id = SUFI.10001
	desc = EVTDESC_SUFI_10001
	border = GFX_event_letter_frame_religion

	trigger = {
		society_rank < 4
		has_character_flag = has_sent_request_to_rank_up
	}
	
	is_triggered_only = yes

	#Yes
	option = {
		name = {
			text = EVTOPTA_10001
		}
		if = { limit = { society_rank < 4 } #Reminder: Remember you can rankup to 4 in some societies
			society_rank_up = 1
		}
		clr_character_flag = has_sent_request_to_rank_up
		ai_chance = { factor = 1 }
	}
	#Yes
	option = {
		name = {
			text = EVTOPTB_10001
		}
		trigger = {
			society_rank == 3
			has_any_lifestyle_trait = no
		}
		society_rank_up = 1
		add_trait = mystic
		clr_character_flag = has_sent_request_to_rank_up
		ai_chance = { factor = 4 }
	}
}

#Becoming stressed about keeping a secret
# character_event = {
    # id = SUFI.10020
    # picture = GFX_evt_uncomfortable
    # border = GFX_event_normal_frame_religion

    # desc = {
    	# trigger = { 
    		# has_dlc = "Mystics" 
    		# trait = paranoid
    	# }
    	# text = EVTDESC_SUFI_10020_A
    	# picture = GFX_evt_uncomfortable
    # }

    # desc = {
    	# trigger = { 
    		# has_dlc = "Mystics" 
    		# NOT = { trait = paranoid }
    	# }
    	# text = EVTDESC_SUFI_10020_B
    	# picture = GFX_evt_uncomfortable
    # }

	# is_in_society = yes
	
    # is_triggered_only = yes
    
    # trigger = {
    	# society_is_criminal = yes
    	# NOT = { trait = stressed }
    # }

    # option = { 
        # name = EVTOPTA_SUFI_10020

	    # add_trait = stressed
    # }
# }

#Excluded from society due to breaking the limitations
character_event = {
	id = SUFI.10021
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = { #If YOU are the grandmaster and there are others in the society...
				OR = {
					is_society_grandmaster = yes
					society_rank == 4
				}
				any_society_member = {
					NOT = { character = ROOT }
					same_society_as = ROOT
				}
			}
			society = {
				random_society_member = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = SUFI.10022 } #Have some rando send the kick-out letter!
				}
			}
		}
		if = {
			limit = { #If you are NOT the grandmaster/a leader...
				NOT = { society_rank == 4 }
			}
			society = {
				random_society_member = {
					limit = {
						OR = {
							is_society_grandmaster = yes
							society_rank == 4
						}
					}
					character_event = { id = SUFI.10022 } #Have the Grand Master send the kick-out letter!
				}
			}
		}
		else = { #If you are the last of your kind...
			ROOT = {
				leave_society = yes
			}
		}
	}
}


character_event = {
    id = SUFI.10022
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { letter_event = { id = SUFI.10023 } } }
}


letter_event = {
	id = SUFI.10023
	desc = EVTDESC_SUFI_10023
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SUFI_10023
		leave_society = yes
	}
}

# Force join AI characters to societies
character_event = {
	id = SUFI.10030
	hide_window = yes
	
	only_rulers = yes
	religion_group = muslim
	is_triggered_only = yes
	
	has_dlc = "Mystics"
	
	immediate = {
		# if = { #mystic already has this and this mod require mystic
			# limit = {
				# ai = yes
				# prisoner = no
				# NOT = { is_incapable = yes }
				# is_in_society = yes
				# society_rank < 3
				# society_can_rank_up = yes
			# }
			# random_list = {
				# 75 = {}
				# 25 = {
					# society_rank_up = 1					
				# }
			# }
		# }
		any_courtier = {
			limit = {
				ai = yes
				prisoner = no
				NOT = { is_incapable = yes }
				is_adult = yes
				is_in_society = no
				controls_religion = no
				block_general_event_trigger = no
			}
			character_event = { id = SUFI.10031 }
		}
		if = {
			limit = {
				ai = yes
				prisoner = no
				NOT = { is_incapable = yes }
				is_adult = yes
				is_in_society = no
				controls_religion = no
				block_general_event_trigger = no
			}
			character_event = { id = SUFI.10031 }
		}
	}
}

character_event = {
	id = SUFI.10031
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = { # do nothing
				modifier = {
					factor = 0.75
					has_sufi_societies_religion_shiite = yes
				}
				modifier = {
					factor = 0.5
					has_sufi_societies_religion_ibadi = yes
				}
			}
			5 = { # try to join a society
				modifier = {
					factor = 2
					higher_tier_than = BARON
				}
				
				random_list = {
					200 = {  }
					100 = { #sunni
						trigger = {
							can_join_society = monastic_order_sunni
						}
						modifier = {
							factor = 3
							OR = {
								trait = zair
								trait = hafiz
								trait = mystic
								trait = theologian
								learning = 16
								is_priest = yes
							}
						}
						modifier = {
							factor = 0.1
							is_female = yes
						}
						join_society = monastic_order_sunni
						random_list = { # Artificially increase society influence for balance purposes
							75 = {
								modifier = {
									factor = 0
									society_influence >= 30
								}
								add_mission_succeed_influence_effect = yes
							}
							25 = {
							}
						}
						if = {
							limit = {
								NOT = {
									society = {
										any_society_member = {
											is_society_grandmaster = yes
										}
									}
								}
							}
							set_society_grandmaster = yes
						}
					}
					100 = { #shiite
						trigger = {
							can_join_society = monastic_order_shiite
						}
						modifier = {
							factor = 3
							OR = {
								trait = zair
								trait = hafiz
								trait = mystic
								trait = theologian
								learning = 16
								is_priest = yes
							}
						}
						modifier = {
							factor = 0.1
							is_female = yes
						}
						join_society = monastic_order_shiite
						random_list = { # Artificially increase society influence for balance purposes
							75 = {
								modifier = {
									factor = 0
									society_influence >= 30
								}
								add_mission_succeed_influence_effect = yes
							}
							25 = {
							}
						}
						if = {
							limit = {
								NOT = {
									society = {
										any_society_member = {
											is_society_grandmaster = yes
										}
									}
								}
							}
							set_society_grandmaster = yes
						}
					}
					100 = { #ibadi
						trigger = {
							can_join_society = monastic_order_ibadi
						}
						modifier = {
							factor = 3
							OR = {
								trait = zair
								trait = hafiz
								trait = mystic
								trait = theologian
								learning = 16
								is_priest = yes
							}
						}
						modifier = {
							factor = 0.1
							is_female = yes
						}
						join_society = monastic_order_ibadi
						random_list = { # Artificially increase society influence for balance purposes
							75 = {
								modifier = {
									factor = 0
									society_influence >= 30
								}
								add_mission_succeed_influence_effect = yes
							}
							25 = {
							}
						}
						if = {
							limit = {
								NOT = {
									society = {
										any_society_member = {
											is_society_grandmaster = yes
										}
									}
								}
							}
							set_society_grandmaster = yes
						}
					}
				}
			}
		}
	}
}

#Notification of invalid
# character_event = {
	# id = SUFI.6992
	# desc = EVTDESC_SUFI_6992
	# border = GFX_event_normal_frame_religion
	# picture = GFX_evt_society_joining

	# is_triggered_only = yes

	# trigger = {
		# OR = {
			# has_quest = quest_secret_religions_conduct_secret_ceremony
			# has_quest = quest_the_assassins_assassination
			# has_quest = quest_the_assassins_collect_debt
			# has_quest = quest_the_devil_worshipers_demonic_possession
			# has_quest = quest_hermetic_gather_ingredients
			# has_quest = quest_devil_worshipers_corrupt_priest
			# has_quest = quest_hermetics_infiltrate_laboratory
			# has_quest = quest_hermetics_find_text
			# has_quest = quest_devil_worshipers_corrupt_priest
			# has_quest = quest_the_devil_worshipers_demonic_possession
			# has_quest = quest_the_assassins_protege
			# has_quest = quest_secret_religious_societies_induct_ruler
			# has_quest = quest_secret_religious_societies_sympathy_ruler
			# has_quest = quest_the_devil_worshipers_demonic_impregnation
		# }
	# }

	# option = {		
		# name = ALAS

		# trigger_switch = {
			# on_trigger = has_quest
			# quest_secret_religions_conduct_secret_ceremony = { clr_quest = { id = quest_secret_religions_conduct_secret_ceremony failure = yes } }
			# quest_the_assassins_assassination = 			{ clr_quest = { id = quest_the_assassins_assassination failure = yes } }
			# quest_the_assassins_collect_debt = 				{ clr_quest = { id = quest_the_assassins_collect_debt failure = yes } }
			# quest_hermetic_gather_ingredients = 			{ clr_quest = { id = quest_hermetic_gather_ingredients failure = yes } }
			# quest_hermetics_infiltrate_laboratory =			{ clr_quest = { id = quest_hermetics_infiltrate_laboratory failure = yes } }
			# quest_hermetics_find_text = 					{ clr_quest = { id = quest_hermetics_find_text failure = yes } }
			# quest_devil_worshipers_corrupt_priest =			{ clr_quest = { id = quest_devil_worshipers_corrupt_priest failure = yes } }
			# quest_the_devil_worshipers_demonic_possession = { clr_quest = { id = quest_the_devil_worshipers_demonic_possession failure = yes } }
			# quest_the_assassins_protege = 					{ clr_quest = { id = quest_the_assassins_protege failure = yes } }
			# quest_secret_religious_societies_induct_ruler = { clr_quest = { id = quest_secret_religious_societies_induct_ruler failure = yes } }
			# quest_secret_religious_societies_sympathy_ruler = { clr_quest = { id = quest_secret_religious_societies_sympathy_ruler failure = yes } }
			# quest_the_devil_worshipers_demonic_impregnation = { clr_quest = { id = quest_the_devil_worshipers_demonic_impregnation failure = yes } }
		# }


		# hidden_effect = {
			# clr_character_flag = A_FAIL
	    	# clr_character_flag = B_FAIL
	    	# clr_character_flag = C_FAIL
	    	# clr_character_flag = D_FAIL
			# clr_character_flag = A_SUCCESS
    		# clr_character_flag = B_SUCCESS
    		# clr_character_flag = C_SUCCESS
    		# clr_character_flag = D_SUCCESS
    		# clr_character_flag = alexandria
    		# clr_character_flag = conduct_secret_ceremony_timer
			# clr_character_flag = do_not_disturb
			# clr_character_flag = bribed_guards
			# clr_character_flag = guards_wake_up
			# clr_character_flag = distraction_failed
			# clr_character_flag = caught_stealing
			# clr_character_flag = caught_destroying
			# clr_character_flag = great_theft
			# clr_character_flag = good_theft
			# clr_character_flag = ok_theft
			# clr_character_flag = lab_destruction
			# clr_character_flag = lab_damage
			# clr_character_flag = lab_explosion_death
			# clr_character_flag = sympathy_argument_friends_family
			# clr_character_flag = sympathy_argument_trauma
			# clr_character_flag = sympathy_argument_profit
			# clr_character_flag = sympathy_argument_personal
			# clr_character_flag = induction_argument_war
			# clr_character_flag = induction_argument_community
			# clr_character_flag = induction_argument_theology
            # clr_character_flag = induction_argument_stewardship
            # clr_character_flag = threaten_personally
            # clr_character_flag = threaten_relation
            # clr_character_flag = threaten_wealth
            # clr_character_flag = collecting_debt
		# }
	# }
# }

# character_event = { # Fired from on_character_leave_society (meant to clear any society related flags and effects)
    # id = SUFI.10018
    # is_triggered_only = yes #only need update for artifacts theft
    # hide_window = yes
    
    # immediate = {
    	# clean_up_after_leaving_society_effect = yes #NOTE: update if more societies are added
    # }
# }

###MISSIONS###
#4000 is tombola
character_event = {
	id = SUFI.4000
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes
	religion_group = muslim
	
	trigger = {
		is_sufi_member_trigger = yes
		is_society_grandmaster = no
		has_any_quest = no
		NOT = { is_inaccessible_trigger = yes }
		NOT = { has_character_modifier = quest_cooldown_timer }
	}

	immediate = {
		random_society_member = {
			limit = {
				is_society_grandmaster = yes
				same_society_as = ROOT
			}
			save_event_target_as = monastic_leader
		}

		random_list = {
			10 = { 
				set_character_flag = monastic_orders_holy_seclusion
			}
			10 = { 
				modifier = { factor = 0 is_playable = no }
				set_character_flag = monastic_orders_mission_charity
			}
			10 = {
				modifier = { factor = 0 NOT = { has_dlc ="Way of Life" } }
				modifier = { factor = 0 has_focus = focus_theology }
				modifier = { factor = 0 is_playable = no } # Only playable characters get focuses
				set_character_flag = monastic_orders_mission_theology
			}
			20 = {
				modifier = { factor = 0 is_playable = no }
				modifier = {
					trait = zair
					factor = 0
				}
				modifier = {
					trait = on_ziyara
					factor = 0
				}
				modifier = {
					is_female = yes
					factor = 0
				}
				modifier = {
					has_alternate_start_parameter = { key = religion_names value = random }
					factor = 0
				}
				set_character_flag = monastic_orders_mission_sufi_pilgrimage
			}
			10 = {
				trigger = {
					is_playable = yes
					any_demesne_province = {
						num_of_empty_holdings = 1			
					}
				}
				modifier = {
					factor = 0 is_tribal = yes
				}
				modifier = {
					factor = 0 is_nomadic = yes
				}
				modifier = { factor = 0 is_playable = no }
				set_character_flag = monastic_orders_mission_temple
			}
			50 = { # AI bypasses missions at times
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
						sufi_purity_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}
			85 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
		event_target:monastic_leader = { character_event = { id = SUFI.4010 days = 7 random = 7 } }
	}
}

#Tombola Ping Event
character_event = {
	id = SUFI.4010
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = {
			trigger_switch = {
				on_trigger = has_character_flag
				monastic_orders_holy_seclusion = 				{ clr_character_flag = monastic_orders_holy_seclusion society_quest_event = { id = SUFI.4402 } }
				monastic_orders_mission_charity = 				{ clr_character_flag = monastic_orders_mission_charity society_quest_event = { id = SUFI.4011 } }
				monastic_orders_mission_theology = 				{ clr_character_flag = monastic_orders_mission_theology society_quest_event = { id = SUFI.4015 } }
				monastic_orders_mission_sufi_pilgrimage = 	{ clr_character_flag = monastic_orders_mission_sufi_pilgrimage society_quest_event = { id = SUFI.8095 } }
				monastic_orders_mission_temple = 				{ clr_character_flag = monastic_orders_mission_temple society_quest_event = { id = SUFI.4023 } }
			}
		}
	}
}

#QUEST: Do penance/meditate
society_quest_event = {
	id = SUFI.4402
	desc = EVTDESC_SUFI_4402
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	option = {
		name = ACCEPT
		set_quest = quest_monastic_order_meditation
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

#Penance/meditation begins
character_event = {
	id = SUFI.4403
	picture = GFX_evt_dark_prayer
	desc = EVTDESC_SUFI_4403
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SUFI_4403

		hidden_effect = {
			set_variable = { which = holy_seclusion_points value = 0 }
			set_character_flag = holy_seclusion_timer
			character_event = { id = SUFI.4404 days = 40 random = 30 } 
		}
	}
}

#Tombola & outcome evaluator for meditation/penance
character_event = {
	id = SUFI.4404
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	immediate = {
		if = {
			limit = {
				OR = {
					is_sufi_member_trigger = no
					NOT = { has_quest = quest_monastic_order_meditation }
				}
			}
			character_event = { id = SUFI.4399 }
			break = yes
		}
		if = {
			limit = { 
				has_quest = quest_monastic_order_meditation
				has_character_modifier = in_meditation
			}
			if = {
				limit = { 
					NOR = {
						check_variable = { which = holy_seclusion_points value = 4 } 
						NOT = { check_variable = { which = holy_seclusion_points value = -2 } }
					}
				}
				clear_event_target = interrupting_child
				random_list = { #Next mission
					30 = { #Struggle with a vice
						modifier = { 
							factor = 0 
							trait = temperate
							trait = charitable
							trait = diligent
							NOT = { trait = lustful }
						}
						modifier = {
							factor = 0
							has_character_flag = holy_seclusion_struggled_with_vice
						}
						set_character_flag = holy_seclusion_struggled_with_vice
						random_list = {
							10 = { 
								modifier = { factor = 0 NOT = { trait = lustful } }
								set_character_flag = holy_seclusion_lustful
							}
							10 = { 
								modifier = { factor = 0 trait = temperate }
								set_character_flag = holy_seclusion_gluttonous
							}
							10 = { 
								modifier = { factor = 0 trait = charitable }
								set_character_flag = holy_seclusion_greedy
							}
							10 = { 
								modifier = { factor = 0 trait = diligent }
								set_character_flag = holy_seclusion_slothful
							}
						}

						character_event = { id = SUFI.4405 }
					}
					10 = { #Lonely
						modifier = {
							factor = 0
							NAND = {
								OR = {
									trait = gregarious
									trait = socializer
								}
								any_courtier = {
									is_adult = yes
									prisoner = no
									NOR = { 
										is_friend = ROOT 
										is_lover = ROOT
										is_rival = ROOT
										any_spouse = { character = ROOT }
									}
								}
							}
						}
						modifier = {
							factor = 0
							has_character_flag = holy_seclusion_struggled_with_loneliness
						}
						set_character_flag = holy_seclusion_struggled_with_loneliness
						character_event = { id = SUFI.4410 }
					}
					10000 = { #Scripture reading 
						modifier = {
							factor = 0
							OR = {
								NOT = {	any_courtier = { has_job_title = job_spiritual } }
								has_character_flag = holy_seclusion_scripture_reading
							}
						}
						set_character_flag = holy_seclusion_scripture_reading
						character_event = { id = SUFI.4414 }
					}
					#Child interrupting
					10 = {
						modifier = {
							factor = 0
							NOT = { 
								any_child = {
									age = 4
									host = { character = ROOT }
									is_adult = no
									prisoner = no
									opinion = { who = ROOT value = 5 }
								}
							}
						}
						modifier = {
							factor = 0
							has_character_flag = holy_seclusion_interrupting_child
						}
						random_child = {
							limit = {
								age = 4
								host = { character = ROOT }
								is_adult = no
								prisoner = no
								opinion = { who = ROOT value = 5 }
							}
							save_event_target_as = interrupting_child
						}
						random_child = {
							limit = {
								age = 4
								host = { character = ROOT }
								is_adult = no
								prisoner = no
								opinion = { who = ROOT value = 5 }
								is_primary_heir = ROOT
								NOR = { 
									has_opinion_modifier = { modifier = kind_parent who = ROOT }
									has_opinion_modifier = { modifier = cruel_parent who = ROOT }
								}
							}
							save_event_target_as = interrupting_child
						}
						set_character_flag = holy_seclusion_interrupting_child
						event_target:interrupting_child = { character_event = { id = SUFI.4419 } }
					}
					10 = { #General success 
						modifier = {
							is_virtous = yes
							factor = 1.5
						}
						modifier = {
							is_wicked = yes
							factor = 0.7
						}
						modifier = {
							is_learned_trigger = yes
							factor = 1.5
						}
						character_event = { id = SUFI.4426 }
					}
					10 = { #If all missions have been done already....
						modifier = {
							factor = 0
							NAND = {
								has_character_flag = holy_seclusion_struggled_with_vice
								has_character_flag = holy_seclusion_struggled_with_loneliness
								has_character_flag = holy_seclusion_scripture_reading
								has_character_flag = holy_seclusion_interrupting_child
							}
						}
						clr_character_flag = holy_seclusion_struggled_with_vice
						clr_character_flag = holy_seclusion_struggled_with_loneliness
						clr_character_flag = holy_seclusion_scripture_reading
						clr_character_flag = holy_seclusion_interrupting_child
					}
				}
				character_event = { id = SUFI.4404 days = 40 random = 30 } #Sends the tombola again
			}
			if = {
				limit = { 
					OR = {
						check_variable = { which = holy_seclusion_points value = 4 } 
						NOT = { check_variable = { which = holy_seclusion_points value = -2 } }
					}
				} 

				random_society_member = {
					limit = {
						is_society_grandmaster = yes
						same_society_as = ROOT
					}
					character_event = { id = SUFI.4427 } #Mission success/fail
				}
			}
		}
	}
}

#Penance/seclusion: Dealing with vice
character_event = {
	id = SUFI.4405
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	hide_from = yes

	immediate = {
		trigger_switch = {
			on_trigger = has_character_flag
			holy_seclusion_lustful = {
				if = {
					limit = {
						any_artifact = {
							OR = {
								has_artifact_flag = about_religion
								artifact_type = the_confessions_of_root
							}
							is_artifact_equipped = yes
						}
					}
					random_artifact = {
						limit = {
							OR = {
								has_artifact_flag = about_religion
								artifact_type = the_confessions_of_root
							}
							is_artifact_equipped = yes
						}
						preferred_limit = {
							quality = 3
						}
						preferred_limit = {
							quality = 2
						}
						preferred_limit = {
							quality = 1
						}
						save_event_target_as = book_target
					}
				}
			}
			holy_seclusion_gluttonous = {
				if = {
					limit = {
						any_artifact = {
							has_artifact_flag = cooking
							is_artifact_equipped = yes
						}
					}
					random_artifact = {
						limit = {
							has_artifact_flag = cooking
							is_artifact_equipped = yes
							NOT = { artifact_type = gastronomic_tonics } #Not really about food
						}
						preferred_limit = {
							quality = 3
						}
						preferred_limit = {
							quality = 2
						}
						preferred_limit = {
							quality = 1
						}
						save_event_target_as = book_target
					}
				}
			}
			holy_seclusion_greedy = {
				if = {
					limit = {
						any_artifact = {
							OR = {
								artifact_type = the_confessions_of_root
								has_artifact_flag = about_diplomacy
							}
							is_artifact_equipped = yes
						}
					}
					random_artifact = {
						limit = {
							OR = {
								artifact_type = the_confessions_of_root
								has_artifact_flag = about_diplomacy
							}
							is_artifact_equipped = yes
						}
						preferred_limit = {
							quality = 3
						}
						preferred_limit = {
							quality = 2
						}
						preferred_limit = {
							quality = 1
						}
						save_event_target_as = book_target
					}
				}
			}
			holy_seclusion_slothful = {
				if = {
					limit = {
						any_artifact = {
							OR = {
								AND = {
									has_artifact_flag = about_dynasty
									original_owner = { NOT = { character = ROOT } }
								}
								has_artifact_flag = poetry
							}
							is_artifact_equipped = yes
						}
					}
					random_artifact = {
						limit = {
							OR = {
								AND = {
									has_artifact_flag = about_dynasty
									original_owner = { NOT = { character = ROOT } }
								}
								has_artifact_flag = poetry
							}
							is_artifact_equipped = yes
						}
						preferred_limit = {
							quality = 3
						}
						preferred_limit = {
							quality = 2
						}
						preferred_limit = {
							quality = 1
						}
						save_event_target_as = book_target
					}
				}
			}
		}
	}
	
	desc = {
		trigger = { has_character_flag = holy_seclusion_lustful }
		text = EVTDESC_SUFI_4405_LUSTFUL
		picture = GFX_evt_dark_love
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_gluttonous }
		text = EVTDESC_SUFI_4405_GLUTTONOUS
		picture = GFX_evt_dark_feast
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_greedy }
		text = EVTDESC_SUFI_4405_GREEDY
		picture = GFX_evt_charity
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_slothful }
		text = EVTDESC_SUFI_4405_SLOTHFUL
		picture = GFX_evt_recovery
	}

	#Indulge
	option = {
		name = {
			trigger = { has_character_flag = holy_seclusion_lustful }
			text = EVTOPTA_SUFI_4405_LUSTFUL
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_gluttonous }
			text = EVTOPTA_SUFI_4405_GLUTTONOUS
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_greedy }
			text = EVTOPTA_SUFI_4405_GREEDY
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_slothful }
			text = EVTOPTA_SUFI_4405_SLOTHFUL
		}
		if = {
			limit = { has_character_flag = holy_seclusion_gluttonous }
			gain_weight_small_effect = yes
			weight_trait_check_effect = yes
		}
		random_list = {
			65 = { 
				custom_tooltip = { 
					# text = EVTOPTA_SUFI_4405_tt_success 
					text = EVTOPTA_SUFI_4405_tt_success
					character_event = { id = SUFI.4406 days = 3 }
				}
			}
			35 = {
				custom_tooltip = { 
					# text = EVTOPTA_SUFI_4405_tt_fail
					text = EVTOPTA_SUFI_4405_tt_fail
					character_event = { id = SUFI.4407 days = 3 }
				}
			}
		}
	}

	#Fight it  (with reading from your library!)
	option = {
		name = {
			trigger = { has_character_flag = holy_seclusion_lustful }
			text = EVTOPTB_SUFI_4405_LUSTFUL_book
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_gluttonous }
			text = EVTOPTB_SUFI_4405_GLUTTONOUS_book
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_greedy }
			text = EVTOPTB_SUFI_4405_GREEDY_book
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_slothful }
			text = EVTOPTB_SUFI_4405_SLOTHFUL_book
		}

		tooltip_info_custom = available_because_books_tt

		if = {
			limit = { has_character_flag = holy_seclusion_gluttonous }
			lose_weight_small_effect = yes
			weight_trait_check_effect = yes
		}

		set_character_flag = used_a_book

		random_list = {
			40 = { 
				custom_tooltip = { 
					# text = EVTOPTB_SUFI_4405_tt_success
					text = EVTOPTB_SUFI_4405_tt_success
					character_event = { id = SUFI.4408 days = 14 }
				}
			}
			60 = {
				custom_tooltip = { 
					# text = EVTOPTB_SUFI_4405_tt_fail
					text = EVTOPTB_SUFI_4405_tt_fail
					character_event = { id = SUFI.4409 days = 14 }
				}
			}
		}
		trigger = {
			event_target:book_target = { always = yes }
		}
	}
	
	#Fight it
	option = {
		name = {
			trigger = { has_character_flag = holy_seclusion_lustful }
			text = EVTOPTB_SUFI_4405_LUSTFUL
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_gluttonous }
			text = EVTOPTB_SUFI_4405_GLUTTONOUS
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_greedy }
			text = EVTOPTB_SUFI_4405_GREEDY
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_slothful }
			text = EVTOPTB_SUFI_4405_SLOTHFUL
		}

		if = {
			limit = { has_character_flag = holy_seclusion_greedy }
			scaled_wealth = { value = -0.5 min = -50 }
		}

		random_list = {
			40 = { 
				custom_tooltip = { 
					# text = EVTOPTB_SUFI_4405_tt_success
					text = EVTOPTB_SUFI_4405_tt_success
					character_event = { id = SUFI.4408 days = 14 }
				}
			}
			60 = {
				custom_tooltip = { 
					# text = EVTOPTB_SUFI_4405_tt_fail
					text = EVTOPTB_SUFI_4405_tt_fail
					character_event = { id = SUFI.4409 days = 14 }
				}
			}
		}
	}
}

#Vice outcome - small success
character_event = {
	id = SUFI.4406
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	hide_from = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	desc = {
		trigger = { 
			has_character_flag = holy_seclusion_lustful 
			event_target:holy_seclusion_lover = { always = yes }
		}
		text = EVTDESC_SUFI_4406_LUSTFUL_A
		picture = GFX_evt_dark_love
	}
	desc = {
		trigger = { 
			has_character_flag = holy_seclusion_lustful 
			event_target:holy_seclusion_lover = { always = no }
		}
		text = EVTDESC_SUFI_4406_LUSTFUL_B
		picture = GFX_evt_dark_love
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_gluttonous }
		text = EVTDESC_SUFI_4406_GLUTTONOUS
		picture = GFX_evt_feast
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_greedy }
		text = EVTDESC_SUFI_4406_GREEDY
		picture = GFX_evt_charity
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_slothful }
		text = EVTDESC_SUFI_4406_SLOTHFUL
		picture = GFX_evt_recovery
	}

	immediate = {
		if = {
			limit = { has_character_flag = holy_seclusion_lustful }
			random_courtier = {
				limit = {
					age = 16
					root_attraction_trigger = yes
					prisoner = no
					NOT = { is_incapable = yes }
					NOR = { 
						trait = sufi_zahid
						trait = celibate
					}
					NOT = { is_close_relative = ROOT }
					is_married = no
					is_attractive_trigger = yes
				}
				save_event_target_as = holy_seclusion_lover
			}
		}
	}

	option = {
		name = {
			trigger = { has_character_flag = holy_seclusion_lustful }
			text = EVTOPTA_SUFI_4406_LUSTFUL
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_gluttonous }
			text = EVTOPTA_SUFI_4406_GLUTTONOUS
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_greedy }
			text = EVTOPTA_SUFI_4406_GREEDY
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_slothful }
			text = EVTOPTA_SUFI_4406_SLOTHFUL
		}

		custom_tooltip = { 
			text = EVTOPTA_SUFI_4406_TOOLTIP
		}

		hidden_effect = { change_variable = { which = holy_seclusion_points value = 1 } }

		if = {
			limit = { 
				has_character_flag = holy_seclusion_lustful 
				event_target:holy_seclusion_lover = { NOT = { is_lover = ROOT } }
			}
			random = {
				chance = 30
				event_target:holy_seclusion_lover = { add_lover = ROOT }
			}
		}

		hidden_effect = {
			clr_character_flag = holy_seclusion_lustful
			clr_character_flag = holy_seclusion_gluttonous
			clr_character_flag = holy_seclusion_greedy
			clr_character_flag = holy_seclusion_slothful
		}
	}
}

#vice outcome - small failure
character_event = {
	id = SUFI.4407
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	hide_from = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	desc = {
		trigger = { has_character_flag = holy_seclusion_lustful }
		text = EVTDESC_SUFI_4407_LUSTFUL
		picture = GFX_evt_recovery
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_gluttonous }
		text = EVTDESC_SUFI_4407_GLUTTONOUS
		picture = GFX_evt_drunk
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_greedy }
		text = EVTDESC_SUFI_4407_GREEDY
		picture = GFX_evt_drunk
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_slothful }
		text = EVTDESC_SUFI_4407_SLOTHFUL
		picture = GFX_evt_drunk
	}
	
	
	option = {
		name = {
			trigger = { has_character_flag = holy_seclusion_lustful }
			text = EVTOPTA_SUFI_4407_LUSTFUL
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_gluttonous }
			text = EVTOPTA_SUFI_4407_GLUTTONOUS
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_greedy }
			text = EVTOPTA_SUFI_4407_GREEDY
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_slothful }
			text = EVTOPTA_SUFI_4407_SLOTHFUL
		}

		custom_tooltip = { 
			text = EVTOPTA_SUFI_4407_TOOLTIP 
		}

		hidden_effect = {
			clr_character_flag = holy_seclusion_lustful
			clr_character_flag = holy_seclusion_gluttonous
			clr_character_flag = holy_seclusion_greedy
			clr_character_flag = holy_seclusion_slothful
		}
	}
}

#Vice outcome big success
character_event = {
	id = SUFI.4408
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	hide_from = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	# desc = { #pre-holy fury
		# trigger = { has_character_flag = holy_seclusion_lustful }
		# text = EVTDESC_SUFI_4408_LUSTFUL
	# }
	# desc = {
		# trigger = { has_character_flag = holy_seclusion_gluttonous }
		# text = EVTDESC_SUFI_4408_GLUTTONOUS
	# }
	# desc = {
		# trigger = { has_character_flag = holy_seclusion_greedy }
		# text = EVTDESC_SUFI_4408_GREEDY
	# }
	# desc = {
		# trigger = { has_character_flag = holy_seclusion_slothful }
		# text = EVTDESC_SUFI_4408_SLOTHFUL
	# }

	desc = {
		trigger = {
			has_character_flag = holy_seclusion_lustful
		}
		text = EVTDESC_SUFI_4408_LUSTFUL
	}
	desc = {
		trigger = {
			has_character_flag = holy_seclusion_gluttonous
		}
		text = EVTDESC_SUFI_4408_GLUTTONOUS
	}
	desc = {
		trigger = {
			has_character_flag = holy_seclusion_greedy
			NOT = { has_character_flag = used_a_book }
		}
		text = EVTDESC_SUFI_4408_GREEDY
	}
	desc = {
		trigger = {
			has_character_flag = holy_seclusion_slothful
			NOT = { has_character_flag = used_a_book }

		}
		text = EVTDESC_SUFI_4408_SLOTHFUL
	}
	desc = {
		trigger = {
			has_character_flag = holy_seclusion_greedy
			has_character_flag = used_a_book
		}
		text = EVTDESC_SUFI_4408_GREEDY_book
	}
	desc = {
		trigger = {
			has_character_flag = holy_seclusion_slothful
			has_character_flag = used_a_book
		}
		text = EVTDESC_SUFI_4408_SLOTHFUL_book
	}

	option = {
		name = {
			trigger = { has_character_flag = holy_seclusion_lustful }
			text = EVTOPTA_SUFI_4408_LUSTFUL
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_gluttonous }
			text = EVTOPTA_SUFI_4408_GLUTTONOUS
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_greedy }
			text = EVTOPTA_SUFI_4408_GREEDY
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_slothful }
			text = EVTOPTA_SUFI_4408_SLOTHFUL
		}

		custom_tooltip = { 
			text = EVTOPTA_SUFI_4408_TOOLTIP
		}

		hidden_effect = { change_variable = { which = holy_seclusion_points value = 2 } }
		hidden_effect = { sufi_purity_effect = yes }
		
		if = {
			limit = { has_character_flag = holy_seclusion_lustful }
			
			if = {
				limit = {
					has_global_flag = HIPEMF_ACTIVE
				}
				add_trait = celibate
			}
			else = { add_trait = sufi_zahid }
			add_character_modifier = {
				name = promise_of_celibacy
				years = 3
			}

			random = {
				chance = 50
				remove_trait_silently_lustful_effect = yes
			}
		}

		if = {
			limit = { has_character_flag = holy_seclusion_gluttonous }
			if = {
				limit = { NOT = { trait = gluttonous } }
				random = {
					chance = 50
					add_trait_temperate_effect = yes
				}
			}
			if = {
				limit = { trait = gluttonous }
				random = {
					chance = 50
					remove_trait_silently_gluttonous_effect = yes
				}
			}
		}

		if = {
			limit = { has_character_flag = holy_seclusion_greedy }

			if = {
				limit = { NOT = { trait = greedy } }
				random = {
					chance = 50
					add_trait_charitable_effect = yes
				}
			}
			if = {
				limit = { trait = greedy }
				random = {
					chance = 50
					remove_trait_silently_greedy_effect = yes
				}
			}
		}

		if = {
			limit = { has_character_flag = holy_seclusion_slothful }

			if = {
				limit = { NOT = { trait = slothful } }
				random = {
					chance = 50
					add_trait_diligent_effect = yes
				}
			}
			if = {
				limit = { trait = slothful }
				random = {
					chance = 50
					remove_trait_slothful_effect = yes
				}
			}
		}

		hidden_effect = {
			clr_character_flag = holy_seclusion_lustful
			clr_character_flag = holy_seclusion_gluttonous
			clr_character_flag = holy_seclusion_greedy
			clr_character_flag = holy_seclusion_slothful
			clr_character_flag = used_a_book
		}
	}
}

#vice outcome - big failure
character_event = {
	id = SUFI.4409
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	hide_from = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	desc = {
		trigger = { has_character_flag = holy_seclusion_lustful }
		text = EVTDESC_SUFI_4409_LUSTFUL
		picture = GFX_evt_brothel
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_gluttonous }
		text = EVTDESC_SUFI_4409_GLUTTONOUS
		picture = GFX_evt_drunk
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_greedy }
		text = EVTDESC_SUFI_4409_GREEDY #was commented in default local
		picture = GFX_evt_drunk
	}
	desc = {
		trigger = { has_character_flag = holy_seclusion_slothful }
		text = EVTDESC_SUFI_4409_SLOTHFUL
		picture = GFX_evt_drunk
	}

	option = {
		name = {
			trigger = { has_character_flag = holy_seclusion_lustful }
			text = EVTOPTA_SUFI_4409_LUSTFUL
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_gluttonous }
			text = EVTOPTA_SUFI_4409_GLUTTONOUS
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_greedy }
			text = EVTOPTA_SUFI_4409_GREEDY
		}
		name = {
			trigger = { has_character_flag = holy_seclusion_slothful }
			text = EVTOPTA_SUFI_4409_SLOTHFUL
		}

		custom_tooltip = { 
			text = EVTOPTA_SUFI_4409_TOOLTIP 
		}

		hidden_effect = { change_variable = { which = holy_seclusion_points value = -5 } }
		
		if = {
			limit = { 
				has_character_flag = holy_seclusion_lustful 
				NOT = { trait = lovers_pox }
			}
			add_trait = lovers_pox
			if = {
				limit = { is_married = yes }
				character_event = { id = 20 }
			}
		}

		if = {
			limit = { has_character_flag = holy_seclusion_gluttonous }
			if = {
				limit = { NOT = { trait = gluttonous } }
				random = {
					chance = 30
					add_trait_gluttonous_effect = yes
				}
			}
		}


		if = {
			limit = { has_character_flag = holy_seclusion_greedy }
			scaled_wealth = { value = 0.5 min = 50 }
			if = {
				limit = { NOT = { trait = greedy } }
				random = {
					chance = 30
					add_trait_greedy_effect = yes
				}
			}
		}

		if = {
			limit = { has_character_flag = holy_seclusion_slothful }
			if = {
				limit = { NOT = { trait = slothful } }
				random = {
					chance = 30
					add_trait_slothful_effect = yes
				}
			}
		}

		add_character_modifier = {
			name = rampant_sinner_sufi
			years = 3
		}

		hidden_effect = {
			clr_character_flag = holy_seclusion_lustful
			clr_character_flag = holy_seclusion_gluttonous
			clr_character_flag = holy_seclusion_greedy
			clr_character_flag = holy_seclusion_slothful
			clr_character_flag = used_a_book
		}
	}
}

#Penance/meditation: struggle with loneliness
character_event = {
	id = SUFI.4410
	# desc = EVTDESC_SUFI_4410
	desc = EVTDESC_SUFI_4410
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	immediate = {
		random_courtier = {
			limit = {
				is_adult = yes
				prisoner = no
				NOR = { 
					is_friend = ROOT 
					is_rival = ROOT
					is_lover = ROOT
					any_spouse = { character = ROOT }
				}
			}
			save_event_target_as = potential_friend
		}
	}

	#Go out and talk with them
	option = {
		name = EVTOPTA_SUFI_4410
		# name = EVTOPTA_SUFI_4410
		custom_tooltip = { text = EVTOPTA_SUFI_4410_TOOLTIP }
		# custom_tooltip = { text = EVTOPTA_SUFI_4410_TOOLTIP }
		hidden_effect = { character_event = { id = SUFI.4411 days = 2 } }
		random = {
			chance = 50
			tooltip = { add_friend = event_target:potential_friend }
			set_character_flag = new_friend
		}

	}

	option = {
		# name = EVTOPTB_SUFI_4410
		name = EVTOPTB_SUFI_4410

		random_list = {
			65 = {
				custom_tooltip = { text = EVTOPTA_SUFI_4406_TOOLTIP }
				hidden_tooltip = { character_event = { id = SUFI.4412 days = 2 } }
			}
			35 = {
				custom_tooltip = { text = EVTOPTA_SUFI_4407_TOOLTIP }
				tooltip = {
					if = {
						limit = { trait = stressed NOT = { trait = depressed } }
						random = {
							chance = 50
							tooltip = { add_trait = depressed }
							set_character_flag = add_depressed
						}
					}
					if = {
						limit = { NOT = { trait = stressed } }
						random = {
							chance = 50
							tooltip = { add_trait = stressed }
							set_character_flag = add_stressed
						}
					}
				}
				hidden_tooltip = { character_event = { id = SUFI.4413 days = 2 } }
			}	
		}

		tooltip = {
			if = {
				limit = { trait = gregarious }
				random = {
					chance = 20
					tooltip = { remove_trait = gregarious }
					set_character_flag = lose_gregarious
				}
			}
		}
	}
}

#You went to talk to them
character_event = {
	id = SUFI.4411
	desc = EVTDESC_SUFI_4411
	# desc = EVTDESC_SUFI_4411
	picture = GFX_evt_muslim_talk
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		# name = EVTOPTA_SUFI_4411
		# custom_tooltip = { text = EVTOPTA_SUFI_4410_TOOLTIP }
		name = EVTOPTA_SUFI_4411
		custom_tooltip = { text = EVTOPTA_SUFI_4410_TOOLTIP }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = -1 } }
		if = {
			limit = { has_character_flag = new_friend }
			add_friend = event_target:potential_friend
			clr_character_flag = new_friend
		}
	}
}

#You managed to deal with it
character_event = {
	id = SUFI.4412
	# desc = EVTDESC_SUFI_4412
	desc = EVTDESC_SUFI_4412
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		# name = EVTOPTA_SUFI_4412
		name = EVTOPTA_SUFI_4412
		custom_tooltip = { text = EVTOPTA_SUFI_4406_TOOLTIP }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = 1 } }

		if = {
			limit = { has_character_flag = lose_gregarious }
			remove_trait = gregarious
			clr_character_flag = lose_gregarious
		}
	}
}

#You get very lonely
character_event = {
	id = SUFI.4413
	desc = EVTDESC_SUFI_4413
	# desc = EVTDESC_SUFI_4413
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		# name = EVTOPTA_SUFI_4413
		name = EVTOPTA_SUFI_4413
		custom_tooltip = { text = EVTOPTA_SUFI_4406_TOOLTIP }

		if = {
			limit = { has_character_flag = lose_gregarious }
			remove_trait = gregarious
			clr_character_flag = lose_gregarious
		}
		if = {
			limit = { has_character_flag = add_depressed }
			add_trait = depressed
			clr_character_flag = add_depressed
		}
		if = {
			limit = { has_character_flag = add_stressed }
			add_trait = stressed
			clr_character_flag = add_stressed
		}
	}
}

#You struggle with the scripture
character_event = {
	id = SUFI.4414
	desc = EVTDESC_SUFI_4414
	# desc = EVTDESC_SUFI_4414
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	immediate = {
		random_courtier = {
			limit = { has_job_title = job_spiritual }
			save_event_target_as = court_spiritual
		}
	}

	#You keep reading
	option = {
		# name = EVTOPTA_SUFI_4414
		name = EVTOPTA_SUFI_4414

		random_list = {
			35 = {
				modifier = {
					is_smart_trigger = yes
					factor = 1.4
				}
				modifier = {
					learning = 14
					factor = 1.4
				}
				modifier = {
					learning = 16
					factor = 1.4
				}
				modifier = {
					is_learned_trigger = yes
					factor = 2
				}
				# custom_tooltip = { text = EVTOPTA_SUFI_4414_TOOLTIP_SUCCESS }
				custom_tooltip = { text = EVTOPTA_SUFI_4414_TOOLTIP_SUCCESS }
				hidden_effect = { character_event = { id = SUFI.4415 days = 3 } }
			}
			65 = {
				modifier = {
					is_dumb_trigger = yes
					factor = 1.5
				}
				modifier = {
					NOT = { learning = 8 }
					factor = 1.5
				}
				# custom_tooltip = { text = EVTOPTA_SUFI_4414_TOOLTIP_FAILURE }
				custom_tooltip = { text = EVTOPTA_SUFI_4414_TOOLTIP_FAILURE }
				hidden_effect = { character_event = { id = SUFI.4416 days = 3 } }
			}
		}
	}

	option = {
		name = EVTOPTB_SUFI_4414

		random_list = {
			65 = {
				# custom_tooltip = { text = EVTOPTB_SUFI_4414_TOOLTIP_SUCCESS }
				custom_tooltip = { text = EVTOPTB_SUFI_4414_TOOLTIP_SUCCESS }
				hidden_effect = { character_event = { id = SUFI.4417 days = 3 } }
			}
			35 = {
				# custom_tooltip = { text = EVTOPTB_SUFI_4414_TOOLTIP_FAILURE }
				custom_tooltip = { text = EVTOPTB_SUFI_4414_TOOLTIP_FAILURE }
				hidden_effect = { character_event = { id = SUFI.4418 days = 3 } }
			}
		}
	}
}

#You interpret the text
character_event = {
	id = SUFI.4415
	desc = EVTDESC_SUFI_4415
	# desc = EVTDESC_SUFI_4415
	picture = GFX_evt_muslim_book
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		name = EVTOPTA_SUFI_4415
		custom_tooltip = { text = EVTOPTA_SUFI_4414_TOOLTIP_SUCCESS }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = 2 } }
		hidden_effect = { sufi_purity_effect = yes }

		piety = 100

		if = {
			limit = { NOT = { trait = erudite } }
			add_trait = erudite
		}
	}
}

#You fail to interpret the text 
character_event = {
	id = SUFI.4416
	# desc = EVTDESC_SUFI_4416
	desc = EVTDESC_SUFI_4416
	picture = GFX_evt_muslim_book
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		name = EVTOPTA_SUFI_4416
		custom_tooltip = { text = EVTOPTA_SUFI_4414_TOOLTIP_FAILURE }
		# custom_tooltip = { text = EVTOPTA_SUFI_4414_TOOLTIP_FAILURE }
	}
}

#You get help
character_event = {
	id = SUFI.4417
	# desc = EVTDESC_SUFI_4417
	desc = EVTDESC_SUFI_4417
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		name = EVTOPTA_SUFI_4415
		custom_tooltip = { text = EVTOPTB_SUFI_4414_TOOLTIP_SUCCESS }
		# custom_tooltip = { text = EVTOPTB_SUFI_4414_TOOLTIP_SUCCESS }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = 1 } }
	}
}

#Unhelpful court chaplain
character_event = {
	id = SUFI.4418
	desc = EVTDESC_SUFI_4418
	# desc = EVTDESC_SUFI_4418
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		# name = EVTOPTA_SUFI_4418
		# custom_tooltip = { text = EVTOPTB_SUFI_4414_TOOLTIP_FAILURE }
		name = EVTOPTA_SUFI_4418
		custom_tooltip = { text = EVTOPTB_SUFI_4414_TOOLTIP_FAILURE }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = -1 } }
		
		if = {
			limit = {
				event_target:court_spiritual = { is_alive = yes }
			}
			opinion = {
				who = event_target:court_spiritual
				modifier = opinion_ungrateful
				years = 5
			}

			reverse_opinion = {
				who = event_target:court_spiritual
				modifier = opinion_ignorant
				years = 5
			}
		}
	}
}

#Your child wants your attention ping
character_event = {
	id = SUFI.4419
	hide_window = yes
	is_triggered_only = yes
	immediate = { FROM = { character_event = { id = SUFI.4420 } } }
}

character_event = {
	id = SUFI.4420
	desc = EVTDESC_SUFI_4420
	picture = GFX_evt_guardian
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	#Teach them about the scripture
	option = {
		name = EVTOPTA_SUFI_4420

		random_list = {
			50 = {
				modifier = {
					factor = 1.5
					event_target:interrupting_child = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.5
					event_target:interrupting_child = { OR = { trait = idolizer trait = mystic } }
				}
				modifier = {
					factor = 1.5
					event_target:interrupting_child = { opinion = { who = ROOT value = 50 } }
				}
				custom_tooltip = { text = EVTOPTA_SUFI_4420_TOOLTIP_SUCCESS }
				event_target:interrupting_child = { 
					set_character_flag = understood_lesson
					hidden_tooltip = { character_event = { id = SUFI.4421 days = 2 } }
				}
			}
			50 = {
				modifier = {
					factor = 1.5
					event_target:interrupting_child = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 1.5
					event_target:interrupting_child = { trait = cynical }
				}
				custom_tooltip = { text = EVTOPTA_SUFI_4420_TOOLTIP_FAILURE }
				event_target:interrupting_child = { 
					set_character_flag = failed_lesson
					hidden_tooltip = { character_event = { id = SUFI.4421 days = 2 } }
				}
			}
		}
	}

	#Be patient with them
	option = {
		name = EVTOPTB_SUFI_4420
		custom_tooltip = { text = EVTOPTB_SUFI_4420_TOOLTIP }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = -1 } }

		random = {
			chance = 20	
			add_trait_kind_effect = yes
		}	

		random_list = {
			80 = {
				reverse_opinion = {
					who = event_target:interrupting_child
					modifier = kind_parent
					years = 10
				}
			}
			20 = {
				modifier = {
					factor = 0
					is_friend = event_target:interrupting_child
				}
				add_friend = event_target:interrupting_child
			}
		}
	}

	#Sho away
	option = {
		name = EVTOPTC_SUFI_4420

		random_list = {
			65 = {
				modifier = {
					is_benevolent_trigger = yes
					factor = 1.5
				}
				modifier = {
					has_pleasant_personality_trigger = yes
					factor = 1.5
				}
				custom_tooltip = { text = EVTOPTC_SUFI_4420_TOOLTIP_SUCCESS }
				event_target:interrupting_child = { 
					set_character_flag = kindly_rejected
					hidden_tooltip = { character_event = { id = SUFI.4421 days = 2 } }
				}
			}
			35 = {
				modifier = {
					is_evil_trigger = yes
					factor = 1.5
				}
				modifier = {
					has_unpleasant_personality_trigger = yes
					factor = 1.5
				}
				custom_tooltip = { text = EVTOPTC_SUFI_4420_TOOLTIP_FAILURE }
				event_target:interrupting_child = { 
					set_character_flag = cruelly_rejected
					hidden_tooltip = { character_event = { id = SUFI.4421 days = 2 } }
				}
			}
		}
	}
}

#Child ping event
character_event = {
	id = SUFI.4421
	hide_window = yes
	is_triggered_only = yes
	immediate = { 
		trigger_switch = {
			on_trigger = has_character_flag 
			understood_lesson 	= { FROM = { character_event = { id = SUFI.4422 } } clr_character_flag = understood_lesson }
			failed_lesson 		= { FROM = { character_event = { id = SUFI.4423 } } clr_character_flag = failed_lesson }
			kindly_rejected 	= { FROM = { character_event = { id = SUFI.4424 } } clr_character_flag = kindly_rejected }
			cruelly_rejected 	= { FROM = { character_event = { id = SUFI.4425 } } clr_character_flag = cruelly_rejected }
		}
	}
}

#Understood lesson
character_event = {
	id = SUFI.4422
	desc = EVTDESC_SUFI_4422
	picture = GFX_evt_muslim_child_book
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		name = EVTOPTA_SUFI_4422
		custom_tooltip = { text = EVTOPTA_SUFI_4420_TOOLTIP_SUCCESS }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = 2 } }
		hidden_effect = { sufi_purity_effect = yes }

		event_target:interrupting_child = {
			if = {
				limit = {
					has_dlc = "Zeus"
					NOT = { trait = idolizer }
				}
				add_trait = idolizer
			}
			if = {
				limit = {
					NOT = { has_dlc = "Zeus" }
					NOT = { trait = mystic }
				}
				add_trait = mystic
			}
			if = {
				limit = { NOT = { is_smart_trigger = yes } }
				random = {
					chance = 20
					add_trait = shrewd
				}
			}
		}

		random_list = {
			80 = {
				reverse_opinion = {
					who = event_target:interrupting_child
					modifier = kind_parent
					years = 10
				}
			}
			20 = {
				modifier = {
					factor = 0
					is_friend = event_target:interrupting_child
				}
				add_friend = event_target:interrupting_child
			}
		}
	}
}

#Did not understand lesson
character_event = {
	id = SUFI.4423
	desc = EVTDESC_SUFI_4423
	picture = GFX_evt_muslim_buly
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		name = EVTOPTA_SUFI_4423
		custom_tooltip = { text = EVTOPTA_SUFI_4420_TOOLTIP_FAILURE }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = -1 } }

		event_target:interrupting_child = {
			if = {
				limit = { NOT = { is_dumb_trigger = yes } }
				random = {
					chance = 15
					add_trait = dull
				}
			}
		}
	}
}	

#Kindly rejected
character_event = {
	id = SUFI.4424
	desc = EVTDESC_SUFI_4424
	picture = GFX_evt_muslim_play
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		name = EVTOPTA_SUFI_4424
		custom_tooltip = { text = EVTOPTC_SUFI_4420_TOOLTIP_SUCCESS }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = 1 } }
	}
}

#Cruelly rejected
character_event = {
	id = SUFI.4425
	desc = EVTDESC_SUFI_4425
	picture = GFX_evt_muslim_buly
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	immediate = { 
		event_target:interrupting_child = {
			mother_even_if_dead = {
				if = {
					limit = { NOT = { character = ROOT } }
					save_event_target_as = other_parent
				}
			}
			father_even_if_dead = {
				if = {
					limit = { NOT = { character = ROOT } }
					save_event_target_as = other_parent
				}
			}
		}
	}

	option = {
		name = EVTOPTA_SUFI_4425
		custom_tooltip = { text = EVTOPTC_SUFI_4420_TOOLTIP_FAILURE }
		hidden_effect = { change_variable = { which = holy_seclusion_points value = -2 } }

		random = {
			chance = 20 
			add_trait_cruel_effect = yes
		}

		random_list = {
			80 = {
				reverse_opinion = {
					who = event_target:interrupting_child
					modifier = cruel_parent
					years = 10
				}
			}
			20 = {
				modifier = {
					factor = 0
					is_friend = event_target:interrupting_child
				}
				add_rival = event_target:interrupting_child
			}
		}
	}
}

#General good outcome
character_event = {
	id = SUFI.4426
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	hide_from = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	desc = {
		trigger = { has_character_flag = success_seculison_desc_A }
		text = EVTDESC_SUFI_4426_A
	}
	desc = {
		trigger = { has_character_flag = success_seculison_desc_B }
		text = EVTDESC_SUFI_4426_B
	}
	desc = {
		trigger = { has_character_flag = success_seculison_desc_C }
		text = EVTDESC_SUFI_4426_C
	}


	immediate = {
		random_list = { #This setup
			33 = { 
				modifier = { factor = 0 has_character_flag = success_seculison_desc_A }
				set_character_flag = success_seculison_desc_A
				clr_character_flag = success_seculison_desc_B
				clr_character_flag = success_seculison_desc_C
			}
			33 = { 
				modifier = { factor = 0 has_character_flag = success_seculison_desc_B }
				set_character_flag = success_seculison_desc_B
				clr_character_flag = success_seculison_desc_A
				clr_character_flag = success_seculison_desc_C
			}
			33 = { 
				modifier = { factor = 0 has_character_flag = success_seculison_desc_C }
				set_character_flag = success_seculison_desc_C
				clr_character_flag = success_seculison_desc_B
				clr_character_flag = success_seculison_desc_A
			}
		}
	}

	option = {
		name =  EVTOPTA_SUFI_4426
		custom_tooltip = { text = EVTOPTA_SUFI_4406_TOOLTIP }

		hidden_effect = {
			change_variable = { which = holy_seclusion_points value = 1 }
			#clr_character_flag = success_seculison_desc_A
			#clr_character_flag = success_seculison_desc_B
			#clr_character_flag = success_seculison_desc_C
		}
	}
}

#Fail/success evaluation for penance/meditation
character_event = {
	id = SUFI.4427
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { FROM = { check_variable = { which = holy_seclusion_points value = 4 } } }
			FROM = { letter_event = { id = SUFI.4428 } }
		}
		if = {
			limit = { FROM = { NOT = { check_variable = { which = holy_seclusion_points value = -2 } } } }
			FROM = { letter_event = { id = SUFI.4429 } }
		}
	}
}

#Penance/meditation success
letter_event = {
	id = SUFI.4428
	border = GFX_event_letter_frame_religion
	desc = EVTDESC_SUFI_4428
	is_triggered_only = yes
	
	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		name = EVTOPTA_SUFI_4428

		clr_quest = quest_monastic_order_meditation
		sound_effect = monastic_orders_meditate_in_seclusion
		remove_character_modifier = in_meditation
		if = {
			limit = {
				any_owned_bloodline = {
					has_bloodline_flag = monastic_saintly_bloodline
				}
			}
			add_society_currency_major_effect = yes
		}
		else = {
			add_society_currency_medium_effect = yes
		}
		hidden_effect = { 
			sufi_purity_effect = yes 
			clr_character_flag = success_seculison_desc_A #Flags from 4426
			clr_character_flag = success_seculison_desc_B
			clr_character_flag = success_seculison_desc_C
			clr_character_flag = holy_seclusion_struggled_with_vice
			clr_character_flag = holy_seclusion_scripture_reading
			clr_character_flag = holy_seclusion_timer
			clr_character_flag = holy_seclusion_struggled_with_loneliness
			clr_character_flag = holy_seclusion_interrupting_child
		}
	}
}

#Penance/meditation failure
letter_event = {
	id = SUFI.4429
	border = GFX_event_letter_frame_religion
	desc = EVTDESC_SUFI_4429
	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		has_quest = quest_monastic_order_meditation
	}

	option = {
		name = EVTOPTA_SUFI_4429

		if = {
			limit = { has_quest = quest_monastic_order_penance }
			clr_quest = { id = quest_monastic_order_penance failure = yes }
			remove_character_modifier = doing_penance
		}
		if = {
			limit = { has_quest = quest_monastic_order_meditation }
			clr_quest = { id = quest_monastic_order_meditation failure = yes }
			remove_character_modifier = in_meditation
		}
		hidden_effect = {
			clr_character_flag = success_seculison_desc_A #Flags from 4426
			clr_character_flag = success_seculison_desc_B
			clr_character_flag = success_seculison_desc_C
		}
	}
}

#Left Monastic Order or cancelled seclusion mission, and therefore rejoins the world of the living
character_event = {
	id = SUFI.4399
	border = GFX_event_normal_frame_religion
	desc = EVTDESC_SUFI_4399
	picture = GFX_evt_recovery

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			remove_character_modifier = doing_penance
			remove_character_modifier = in_meditation
		}
	}

	option = {
		name = EVTOPTA_SUFI_4399

		clr_quest = { id = quest_monastic_order_meditation failure = yes }
		hidden_effect = {
			hidden_effect = {
				clr_character_flag = success_seculison_desc_A #Flags from 4426
				clr_character_flag = success_seculison_desc_B
				clr_character_flag = success_seculison_desc_C
				clr_character_flag = holy_seclusion_struggled_with_vice
				clr_character_flag = holy_seclusion_scripture_reading
				clr_character_flag = holy_seclusion_timer
				clr_character_flag = holy_seclusion_struggled_with_loneliness
				clr_character_flag = holy_seclusion_interrupting_child
			}
		}
	}
}


#MISSION: Do charity
society_quest_event = {
	id = SUFI.4011
	desc = EVTDESC_SUFI_4011
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	option = {
		name = ACCEPT
		set_quest = quest_monastic_order_donate_to_charity
	}
	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}


#MISSION: Theology focus
society_quest_event = {
	id = SUFI.4015
	desc = EVTDESC_SUFI_4015
	picture = GFX_evt_dark_prayer
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_focus = focus_theology
			has_any_quest = yes
		}
	}

	option = {
		name = ACCEPT
		set_quest = quest_monastic_order_theology_focus_sufi
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

#send to grandmaster for Ping
character_event = {
	id = SUFI.4016
	is_triggered_only = yes
	hide_window = yes

	religion_group = muslim
	is_triggered_only = yes
	
	trigger = {
		has_quest = quest_monastic_order_theology_focus_sufi
	}
	
	immediate = {
		random_society_member = {
			limit = {
				same_society_as = ROOT
				is_society_grandmaster = yes
			}
			character_event = {
				id = SUFI.4017
			}
		}
	}
}


#Ping
character_event = {
	id = SUFI.4017
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = {
			letter_event = {
				id = SUFI.4018
			}
		}
	}
}

letter_event = {
	id = SUFI.4018
	desc = EVTDESC_SUFI_4018
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes


	option = {
		name = EVTOPT_SUFI_4018
		
		clr_quest = quest_monastic_order_theology_focus_sufi
		sound_effect = monastic_orders_pick_theology_focus
		hidden_effect = { sufi_purity_effect = yes }
		
		if = {
			limit = {
				any_owned_bloodline = {
					has_bloodline_flag = monastic_saintly_bloodline
				}
			}
			add_society_currency_medium_effect = yes
		}
		else = {
			add_society_currency_minor_effect = yes
		}
	}

}


#MISSION: Dharmic Pilgrimage
society_quest_event = {
	id = SUFI.8095
	desc = EVTDESC_SUFI_4019
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes


	option = {
		name = ACCEPT
		set_quest = quest_sufi_monastic_order_pilgrimage
				character_event = {
					id = SUFI.80951
					days = 30
				}
	}
	option = {
		name = DECLINE

		hidden_effect = {
			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}
	}
}
#Hajj check Ping
character_event = {
	id = SUFI.80951
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				trait = zair
			}
			character_event = {
				id = SUFI.8096
				days = 1
			}
		}
		else = {
			character_event = {
				id = SUFI.80951
				days = 30
			}
		}
	}
}
#send to grandmaster for Ping
character_event = {
	id = SUFI.8096
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = { #If YOU are the leader of the society, find someone random...
			limit = {
				is_society_grandmaster = yes
			}
			random_society_member = {
				limit = {
					same_society_as = ROOT
					NOT = { character = ROOT }
				}
				character_event = {
					id = SUFI.8097
				}
			}
		}
		else_if = { #Else, find the leader (provided they are available)...
			limit = {
				any_society_member = {
					same_society_as = ROOT
					is_society_grandmaster = yes
					NOT = { character = ROOT }
					block_general_event_trigger = no
				}
			}
			random_society_member = {
				limit = {
					same_society_as = ROOT
					is_society_grandmaster = yes
					NOT = { character = ROOT }
					block_general_event_trigger = no
				}
				character_event = {
					id = SUFI.8097
				}
			}		
		}
		else_if = { #If not, find someone who is...
			limit = {
				any_society_member = {
					same_society_as = ROOT
					NOT = { character = ROOT }
					block_general_event_trigger = no
				}
			}
			random_society_member = {
				limit = {
					same_society_as = ROOT
					NOT = { character = ROOT }
					block_general_event_trigger = no
				}
				character_event = {
					id = SUFI.8097
				}
			}		
		}
		else = { #Else, send it to yourself ...
			character_event = {
				id = SUFI.8097
			}
		}
	}
}


#Ping
character_event = {
	id = SUFI.8097
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = {
			character_event = {
				id = SUFI.8099
			}
		}
	}
}

#Done
letter_event = {
	id = SUFI.8099
	picture = GFX_evt_pilgrims_epic_journey_desert
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	desc = {
		trigger = { FROM = { NOT = { character = ROOT } } }
		text = EVTDESC_SUFI_8099
	}
	desc = {
		trigger = { FROM = { character = ROOT } } #Added in case everyone is in prison or something...!
		text = EVTDESC_SUFI_8099 #no need, wont ever happen
	}


	trigger = { has_quest = quest_sufi_monastic_order_pilgrimage }

	option = {
		name = EVTOPT_SUFI_8099
		
		clr_quest = quest_sufi_monastic_order_pilgrimage
		sound_effect = monastic_orders_pilgrimage
		
		if = {
			limit = {
				any_owned_bloodline = {
					has_bloodline_flag = monastic_saintly_bloodline
				}
			}
			add_society_currency_large_effect = yes
		}
		else = {
			add_society_currency_major_effect = yes
		}
	}
}

#MISSION: Build a Temple
society_quest_event = {
	id = SUFI.4023
	desc = EVTDESC_SUFI_4023
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes


	option = {
		name = ACCEPT
		set_quest = monastic_orders_sufi_temple_construction
	}
	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

#send to grandmaster for Ping
character_event = {
	id = SUFI.4024
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_quest = monastic_orders_sufi_temple_construction
		FROM = {
			holding_type = temple
		}
	}
	
	immediate = {
		random_society_member = {
			limit = {
				same_society_as = ROOT
				is_society_grandmaster = yes
			}
			character_event = {
				id = SUFI.4025
			}
		}
	}
}


#Ping
character_event = {
	id = SUFI.4025
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = {
			character_event = {
				id = SUFI.4026
			}
		}
	}
}

letter_event = {
	id = SUFI.4026
	desc = EVTDESC_SUFI_4026
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPT_SUFI_4026
		clr_quest = monastic_orders_sufi_temple_construction
		sound_effect = monastic_orders_build_temple_holding
		hidden_effect = { sufi_purity_effect = yes }
		if = {
			limit = {
				any_owned_bloodline = {
					has_bloodline_flag = monastic_saintly_bloodline
				}
			}
			add_society_currency_large_effect = yes
		}
		else = {
			add_society_currency_major_effect = yes		
		}
	}
}



###POWERS###

#POWER: Swapping Celibacy
character_event = {
	id = SUFI.4090
	desc = EVTDESC_SUFI_4090
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPT_SUFI_4090
		if = {
			limit = {
				has_global_flag = HIPEMF_ACTIVE
			}
			add_trait = celibate
		}
		else = { add_trait = sufi_zahid }
	}
	option = {
		name = EVTOPTB_SUFI_4090
		change_society_currency = 50
	}
}

character_event = {
	id = SUFI.4091
	desc = EVTDESC_SUFI_4091
	picture = GFX_evt_pregnancy
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes


	option = {
		name = EVTOPT_SUFI_4091
		if = {
			limit = {
				has_global_flag = HIPEMF_ACTIVE
				trait = celibate
			}
			remove_trait = celibate
		}
		else = { remove_trait = sufi_zahid }
		if = {
			limit = {
				is_sufi_member_trigger = yes
			}
			change_society_currency = -100
		}
	}
}

# #POWER: Passive trait improvement ###Purity effect now only triggered through mission success
# character_event = {
	# id = SUFI.4430
	# hide_window = yes
# 
	# religion_group = indian_group
	# is_in_society = yes
	# capable_only = yes
	# prisoner = no
	# min_age = 16
# 	
	# is_triggered_only = yes
	# is_in_society = yes
# 	
	# trigger = { 
		# OR = {
			# society_member_of = monastic_order_buddhist
			# society_member_of = monastic_order_jain
		# }
	# }
# 
	# immediate = {
		# change_variable = { which = "global_passive_purity_possible" value = 1 }
		# random = {
			# chance = 20
			# modifier = {
				# factor = 1.3
				# society_rank >= 2
			# }
			# modifier = {
				# factor = 1.3
				# society_rank >= 3
			# }
			# modifier = {
				# factor = 1.3
				# society_rank >= 4
			# }
			# change_variable = { which = "global_passive_purity_fired" value = 1 }
			# character_event = { id = SUFI.4400 }
		# }
	# }
# }


#POWER: Invite monk or nun 
character_event = {
    id = SUFI.4432
    hide_window = yes

    is_triggered_only = yes

    trigger = { is_sufi_member_trigger = yes }

	immediate = {
		clr_character_flag = ascetic_arriving
		random_list = {
			33 = {
				create_character = {
					random_traits = yes
					dynasty = none
					religion = ROOT
					female = no
					age = 22
					health = 6
				}
				new_character = { save_event_target_as = ascetic }
			}
			33 = {
				create_character = {
					random_traits = yes
					dynasty = none
					religion = ROOT
					female = no
					age = 42
					health = 6
				}
				new_character = { save_event_target_as = ascetic }
			}
			33 = {
				create_character = {
					random_traits = yes
					dynasty = none
					religion = ROOT
					female = no
					age = 65
					health = 6
				}
				new_character = { save_event_target_as = ascetic }
			}
		}

		event_target:ascetic = {
			join_prev_sufi_order_society = yes
		
			#Set correct education
			remove_education_effect = yes
			random_list = {
				60 = { add_trait = scholarly_theologian }
				40 = { add_trait = mastermind_theologian }
			}

			#Up  learning
			random_list = {
				25 = { change_learning = 3 }
				25 = { change_learning = 4 }
				25 = { change_learning = 5 }
				25 = { change_learning = 6 }
			}

			#Set some interesting traits 

			#Nun/monk traits
			add_trait = hafiz
			random = {
				chance = 50
				add_trait = hajjaj
			}
			# add_trait = mystic
			remove_trait = cynical

			#Nice congential
			random_list = {
				10 = {
					add_trait = fair
					remove_trait = ugly
				}
				5 = {
					add_trait = genius
					remove_trait = imbecile
					remove_trait = quick
					remove_trait = slow
				}
				10 = {
					add_trait = quick
					remove_trait = imbecile
					remove_trait = genius
					remove_trait = slow
				}
				5 = {
					add_trait = strong
					remove_trait = weak
				}
				100 = { }
			}

			#Lifestyle
			remove_lifestyle_trait_effect = yes
			random_list = {
				5 = { }
				15 = { add_trait = faqih }
				10 = { add_trait = theologian }
				15 = { add_trait = mystic }
			}

			random = {
				chance = 50
				add_trait = sufi_zahid
			}
			#Virtues
			remove_trait = lustful
			remove_trait = wroth
			remove_trait = gluttonous
			remove_trait = cruel
			random = {
				chance = 20
				remove_trait = envious
				add_trait = kind
			}
			random = {
				chance = 20
				remove_trait = greedy
				add_trait = charitable
			}
			random = {
				chance = 10
				add_trait = temperate
				lose_weight_small_effect = yes
				weight_trait_check_effect = yes
			}
			random = {
				chance = 5
				add_trait = patient
				remove_trait = wroth
			}
			random = {
				chance = 10
				add_trait = humble
				remove_trait = proud
			}
			random = {
				chance = 5
				remove_trait = slothful
				remove_trait = diligent
			}

			#Misc traits
			remove_trait = deceitful
			remove_trait = arbitrary
			remove_trait = cynical
			random = {
				chance = 10
				add_trait = honest
			}
			random = {
				chance = 10
				add_trait = just
			}
			random = {
				chance = 15
				add_trait = erudite
			}
			random = {
				chance = 10
				add_trait = content
				remove_trait = ambitious
			}
			if = {
				limit = { has_dlc = "Reapers" }
				random = {
					chance = 33
					add_trait = physician
				}
			}

			#Nicknames
			random_list = {
				10 = {
					give_nickname = nick_the_holy
				}
				10 = { 
					modifier = {
						factor = 0
						NAND = {
							trait = kind
							trait = charitable
							trait = humble
						}
					}
					give_nickname = nick_the_wali
				}
				10 = { 
					modifier = {
						factor = 0
						NAND = {
							trait = kind
							trait = charitable
						}
					}
					give_nickname = nick_the_kind
				}
				10 = { 
					modifier = {
						factor = 0
						NAND = {
							trait = charitable
							trait = just
						}
					}
					give_nickname = nick_the_good
				}
				10 = { 
					modifier = {
						factor = 0
						OR = {
							is_smart_trigger = yes
							trait = just
							trait = patient
							trait = scholar
						}
					}
					give_nickname = nick_the_wise
				}
				50 = { }
			}
			character_event = { id = SUFI.4433 }	
		}
	}
}

#Ping event for new monk/nun
character_event = {
	id = SUFI.4433
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = { character_event = { id = SUFI.4434 } }
	}
}

#Introduction of new monk/nun
character_event = {
	id = SUFI.4434
	desc = EVTDESC_SUFI_4434
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SUFI_4434
		reverse_opinion = {
			who = FROM
			modifier = opinion_loyal_servant
		}
	}
}
#POWER: Convert County
#Notification for ruler who performs the power
character_event = {
	id = SUFI.4990
	picture = GFX_evt_charity
	desc = EVTDESC_SUFI_4990
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	notification = yes
	
	option = {
		name = EXCELLENT
	}
}

#Notification event for county owner if different from user
character_event = {
	id = SUFI.4991
	picture = GFX_evt_charity
	desc = EVTDESC_SUFI_4991
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = I_SEE
	}
}

#POWER: Rk2 Remove sin "spiritual_guidance"
#Notification for when you do it on someone
character_event = {
	id = SUFI.4950
	picture = GFX_evt_dark_prayer
	desc = EVTDESC_SUFI_4950
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
	}
}

#Notification for when you are targeted
character_event = {
	id = SUFI.4951
	picture = GFX_evt_dark_prayer
	desc = EVTDESC_SUFI_4951
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = I_SEE
		if = {
			limit = { has_character_flag = spiritual_guidance_gluttonous }
			tooltip = { remove_trait = gluttonous }
		}
		if = {
			limit = { has_character_flag = spiritual_guidance_greedy }
			tooltip = { remove_trait = greedy }
		}
		if = {
			limit = { has_character_flag = spiritual_guidance_slothful }
			tooltip = { remove_trait = slothful }
		}
		if = {
			limit = { has_character_flag = spiritual_guidance_wroth }
			tooltip = { remove_trait = wroth }
		}
		if = {
			limit = { has_character_flag = spiritual_guidance_envious }
			tooltip = { remove_trait = envious }
		}
		if = {
			limit = { has_character_flag = spiritual_guidance_proud }
			tooltip = { remove_trait = proud }
		}
		clr_character_flag = spiritual_guidance_gluttonous
		clr_character_flag = spiritual_guidance_greedy
		clr_character_flag = spiritual_guidance_slothful
		clr_character_flag = spiritual_guidance_wroth
		clr_character_flag = spiritual_guidance_envious
		clr_character_flag = spiritual_guidance_proud
	}
}

#POWER: Rk3 Remove sin "teach_virtue"
#Notification for when you do it on someone
character_event = {
	id = SUFI.4960
	picture = GFX_evt_religious_exultation
	desc = EVTDESC_SUFI_4960
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
	}
}

#Notification for when you are targeted
character_event = {
	id = SUFI.4961
	picture = GFX_evt_religious_exultation
	desc = EVTDESC_SUFI_4961
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = I_SEE
		if = {
			limit = { has_character_flag = spiritual_guidance_lustful }
			tooltip = { remove_trait = lustful }
		}
		if = {
			limit = { has_character_flag = teach_virtue_temperate }
			tooltip = { add_trait = temperate }
		}
		if = {
			limit = { has_character_flag = teach_virtue_charitable }
			tooltip = { add_trait = charitable }
		}
		if = {
			limit = { has_character_flag = teach_virtue_diligent }
			tooltip = { add_trait = diligent }
		}
		if = {
			limit = { has_character_flag = teach_virtue_patient }
			tooltip = { add_trait = patient }
		}
		if = {
			limit = { has_character_flag = teach_virtue_kind }
			tooltip = { add_trait = kind }
		}
		if = {
			limit = { has_character_flag = teach_virtue_humble }
			tooltip = { add_trait = humble }
		}
		clr_character_flag = spiritual_guidance_lustful
		clr_character_flag = teach_virtue_temperate
		clr_character_flag = teach_virtue_charitable
		clr_character_flag = teach_virtue_diligent
		clr_character_flag = teach_virtue_patient
		clr_character_flag = teach_virtue_kind
		clr_character_flag = teach_virtue_humble
	}
}


###ACTIONS###

#ACTION: Donating to charity

#Leader Ping for charity
character_event = {
	id = SUFI.4013
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = {
			letter_event = {
				id = SUFI.4014
			}
		}
	}
}

letter_event = {
	id = SUFI.4014
	desc = EVTDESC_SUFI_4014
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
	}

	option = {
		name = EVTOPT_SUFI_4014
			
		wealth = -100
		if = {
			limit = { NOT = { has_quest = quest_monastic_order_donate_to_charity } }
			if = {
				limit = {
					any_owned_bloodline = {
						has_bloodline_flag = monastic_saintly_bloodline 
					}
				}
				add_society_currency_medium_effect = yes
			}
			else = {
				add_society_currency_minor_effect = yes
			}
		}
		
		if = {
			limit = { has_quest = quest_monastic_order_donate_to_charity }
			clr_quest = quest_monastic_order_donate_to_charity
			sound_effect = monastic_orders_donate_charity
			hidden_effect = { sufi_purity_effect = yes }
			if = {
				limit = {
					any_owned_bloodline = {
						has_bloodline_flag = monastic_saintly_bloodline
					}
				}
				add_society_currency_major_effect = yes
			}
			else = {
				add_society_currency_medium_effect = yes			
			}
		}

		add_character_modifier = {
			modifier = recently_donated_to_charity
			days = 360
		}
		if = {
			limit = { NOT = { trait = greedy } }
			random = {
				chance = 30
				add_trait = charitable
			}
		}
		if = {
			limit = { trait = greedy }
			random = {
				chance = 40
				remove_trait = greedy
			}
		}
		clr_character_flag = donate_to_charity_cooldown
	}
}


###MISC###

#Soul purity effect

character_event = {
	id = SUFI.4400
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion

	desc = {
		trigger = { has_character_flag = purity_remove_cynical }
		text = EVTDESC_SUFI_4400_REMOVE_CYNICAL
	}
	desc = {
		trigger = { has_character_flag = purity_remove_gluttonous }
		text = EVTDESC_SUFI_4400_REMOVE_GLUTTONOUS
	}
	desc = {
		trigger = { has_character_flag = purity_remove_greedy }
		text = EVTDESC_SUFI_4400_REMOVE_GREEDY
	}
	desc = {
		trigger = { has_character_flag = purity_remove_slothful }
		text = EVTDESC_SUFI_4400_REMOVE_SLOTHFUL
	}
	desc = {
		trigger = { has_character_flag = purity_remove_envious }
		text = EVTDESC_SUFI_4400_REMOVE_ENVIOUS
	}
	desc = {
		trigger = { has_character_flag = purity_remove_wroth }
		text = EVTDESC_SUFI_4400_REMOVE_WROTH
	}
	desc = {
		trigger = { has_character_flag = purity_remove_proud }
		text = EVTDESC_SUFI_4400_REMOVE_PROUD
	}
	desc = {
		trigger = { has_character_flag = purity_remove_deceitful }
		text = EVTDESC_SUFI_4400_REMOVE_DECEITFUL
	}
	desc = {
		trigger = { has_character_flag = purity_remove_cruel }
		text = EVTDESC_SUFI_4400_REMOVE_CRUEL
	}
	desc = {
		trigger = { has_character_flag = purity_remove_lustful }
		text = EVTDESC_SUFI_4400_REMOVE_LUSTFUL
	}
	desc = {
		trigger = { has_character_flag = purity_add_humble }
		text = EVTDESC_SUFI_4400_ADD_HUMBLE
	}
	desc = {
		trigger = { has_character_flag = purity_add_charitable }
		text = EVTDESC_SUFI_4400_ADD_CHARITABLE
	}
	desc = {
		trigger = { has_character_flag = purity_add_kind }
		text = EVTDESC_SUFI_4400_ADD_KIND
	}
	desc = {
		trigger = { has_character_flag = purity_add_temperate }
		text = EVTDESC_SUFI_4400_ADD_TEMPERATE
	}
	desc = {
		trigger = { has_character_flag = purity_add_honest }
		text = EVTDESC_SUFI_4400_ADD_HONEST
	}
	desc = {
		trigger = { has_character_flag = purity_remove_ambitious }
		text = EVTDESC_SUFI_4400_REMOVE_AMBITIOUS
	}
	desc = {
		trigger = { has_character_flag = purity_add_content }
		text = EVTDESC_SUFI_4400_ADD_CONTENT
	}
	desc = {
		trigger = { has_character_flag = purity_add_patient }
		text = EVTDESC_SUFI_4400_ADD_PATIENT
	}
	desc = {
		trigger = { has_character_flag = purity_add_diligent }
		text = EVTDESC_SUFI_4400_ADD_DILIGENT
	}

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
		OR = {
			trait = cynical
			trait = gluttonous
			trait = greedy
			trait = slothful
			trait = envious
			trait = wroth
			trait = proud
			trait = deceitful
			trait = cruel
			trait = lustful
			trait = ambitious
			NOT = { trait = humble }
			NOT = { trait = charitable }
			NOT = { trait = kind }
			NOT = { trait = temperate }
			NOT = { trait = honest }
			NOT = { trait = patient }
			NOT = { trait = diligent }
			NOT = { trait = content }
		}
	}

	immediate = {
		#FIRST STAGE
		#Removes cynic, gluttonous, greedy, slothful, lustful, envious, wrath, pride, deceitful, 
		#Adds humble, charitable
		if = {
			limit = {
				OR = {
					trait = cynical
					trait = gluttonous
					trait = greedy
					trait = slothful
					trait = envious
					trait = wroth
					trait = proud
					trait = deceitful
					trait = cruel
					trait = lustful
					NOT = { trait = humble }
					NOT = { trait = charitable }
				}
			}
			random_list = {
				15 = {
					modifier = { factor = 0 NOT = { trait = cynical } }
					set_character_flag = purity_remove_cynical
				}
				10 = {
					modifier = { factor = 0 NOT = { trait = gluttonous } }
					set_character_flag = purity_remove_gluttonous
				}
				10 = {
					modifier = { factor = 0 NOT = { trait = greedy } }
					set_character_flag = purity_remove_greedy
				}
				10 = {
					modifier = { factor = 0 NOT = { trait = slothful } }
					set_character_flag = purity_remove_slothful
				}
				10 = {
					modifier = { factor = 0 NOT = { trait = envious } }
					set_character_flag = purity_remove_envious
				}
				10 = {
					modifier = { factor = 0 NOT = { trait = wroth } }
					set_character_flag = purity_remove_wroth
				}
				10 = {
					modifier = { factor = 0 NOT = { trait = proud } }
					set_character_flag = purity_remove_proud
				}
				10 = {
					modifier = { factor = 0 NOT = { trait = deceitful } }
					set_character_flag = purity_remove_deceitful
				}
				10 = {
					modifier = { factor = 0 NOT = { trait = cruel } }
					set_character_flag = purity_remove_cruel
				}
				10 = {
					modifier = { 
						factor = 0
						NOT = { trait = lustful }
					}
					set_character_flag = purity_remove_lustful
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							trait = humble
							trait = proud
						}
					}
					set_character_flag = purity_add_humble
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							trait = charitable
							trait = greedy
						}
					}
					set_character_flag = purity_add_charitable
				}
			}
		}
	
		#SECOND STAGE
		#Add traits chaste, kind, temperate, honest
		if = {
			limit = {
				NOR = {
					trait = cynical
					trait = gluttonous
					trait = slothful
					trait = envious
					trait = wroth
					trait = deceitful
					trait = cruel
					trait = lustful
				}
				trait = charitable
				trait = humble
				NAND = {
					trait = kind
					trait = temperate
					trait = honest
				}
			}
			random_list = {
				10 = {
					modifier = { factor = 0 trait = kind }
					set_character_flag = purity_add_kind
				}
				10 = {
					modifier = { factor = 0 trait = temperate }
					set_character_flag = purity_add_temperate
				}
				10 = {
					modifier = { factor = 0 trait = honest }
					set_character_flag = purity_add_honest
				}
			}
		}
		#THIRD STAGE
		#Removes ambitious
		#Adds patient, diligent, content
		if = {
			limit = {
				NOR = {
					trait = cynical
					trait = slothful
					trait = wroth
					trait = cruel
				}
				trait = charitable
				trait = humble
				trait = kind
				trait = temperate
				trait = honest
			}

			random_list = {
				10 = {
					modifier = { factor = 0 NOT = { trait = ambitious } }
					set_character_flag = purity_remove_ambitious
				}
				10 = {
					modifier = {
						factor =  0
						OR = {
							trait = ambitious
							trait = content
						}
					}
					set_character_flag = purity_add_content
				}
				10 = {
					modifier = { factor = 0 trait = patient }
					set_character_flag = purity_add_patient
				}
				10 = {
					modifier = { factor = 0 trait = diligent }
					set_character_flag = purity_add_diligent
				}
			}
		}
	}

	option = {
		name = EVTOPTA_SUFI_4400

		trigger_switch = {
			on_trigger = has_character_flag
			purity_remove_cynical		= { remove_trait = cynical }
			purity_remove_gluttonous	= { remove_trait = gluttonous }
			purity_remove_greedy		= { remove_trait = greedy }
			purity_remove_slothful		= { remove_trait = slothful }
			purity_remove_envious		= { remove_trait = envious }
			purity_remove_wroth			= { remove_trait = wroth }
			purity_remove_proud			= { remove_trait = proud }
			purity_remove_deceitful     = { remove_trait = deceitful }
			purity_remove_cruel			= { remove_trait = cruel }
			purity_remove_lustful		= { remove_trait = lustful }
			purity_add_humble			= { add_trait = humble }
			purity_add_charitable		= { add_trait = charitable }
			purity_add_kind				= { add_trait = kind }
			purity_add_temperate		= { add_trait = temperate }
			purity_add_honest			= { add_trait = honest }
			purity_remove_ambitious		= { remove_trait = ambitious }
			purity_add_content			= { add_trait = content }
			purity_add_patient			= { add_trait = patient }
			purity_add_diligent			= { add_trait = diligent }
		}
		if = {
			limit = {
				trait = decadent
			}
			# random = {
				# chance = 75
				remove_trait = decadent
			# }
		}

		clr_character_flag = purity_remove_cynical
		clr_character_flag = purity_remove_gluttonous
		clr_character_flag = purity_remove_greedy
		clr_character_flag = purity_remove_slothful
		clr_character_flag = purity_remove_envious
		clr_character_flag = purity_remove_wroth
		clr_character_flag = purity_remove_proud
		clr_character_flag = purity_remove_deceitful
		clr_character_flag = purity_remove_cruel
		clr_character_flag = purity_remove_lustful
		clr_character_flag = purity_add_humble
		clr_character_flag = purity_add_charitable
		clr_character_flag = purity_add_kind
		clr_character_flag = purity_add_temperate
		clr_character_flag = purity_add_honest
		clr_character_flag = purity_remove_ambitious
		clr_character_flag = purity_add_content
		clr_character_flag = purity_add_patient
		clr_character_flag = purity_add_diligent
	}
}
#Random relic reward for lvl 3 event
letter_event = {
	id = SUFI.4431
	desc = EVTDESC_SUFI_4431

	is_triggered_only = yes

	trigger = {
		society_rank >= 3
		is_sufi_member_trigger = yes
	}

	option = {
	 	name = EVTOPTA_SUFI_4428
		random_list = {
			25 = {
				add_artifact = ancient_quran
			}
			25 = {
				add_artifact = fine_calligraphy
			}
			25 = {
				add_artifact = ceremonial_scimitar
			}
			25 = {
				add_artifact = old_world_prayer_mat
			}
		}
	}
}

###INTERACTION EVENTS###

#Monastic Friendship & Love #

#Starter Event for Monastic Friendship - I need a friend.
character_event = {
	id = SUFI.4435
	picture = GFX_evt_muslim_market_mosque
	desc = EVTDESC_SUFI_4435
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	only_capable = yes
	religion_group = muslim
	
	trigger = {
		is_sufi_member_trigger = yes
		NOT = { is_inaccessible_trigger = yes }
		NOT = { trait = homosexual }
		any_society_member = {
			same_society_as = ROOT
			NOT = { character = ROOT }
			ai = yes
			opinion = {
				who = ROOT
				value = 0
			}
			reverse_opinion = {
				who = ROOT
				value = 0
			}
			NOR = {
				trait = amateurish_plotter
				trait = flamboyant_schemer
				trait = intricate_webweaver
				trait = elusive_shadow
				is_rival = ROOT
				is_friend = ROOT
				is_lover = ROOT
				trait = chaste
				trait = sufi_zahid
			}
			OR = {
				AND = {
					is_female = no
					ROOT = { is_female = no }
				}
				AND = {
					is_female = yes
					ROOT = { is_female = yes }
				}
			}
		}
	}

	immediate = {
		save_event_target_as = monastic_befriender
		random_society_member = {
			limit = {
				same_society_as = ROOT
				NOT = { character = ROOT }
				ai = yes
				AND = {
					opinion = {
						who = ROOT
						value = 0
					}
					reverse_opinion = {
						who = ROOT
						value = 0
					}
					NOR = {
						trait = amateurish_plotter
						trait = flamboyant_schemer
						trait = intricate_webweaver
						trait = elusive_shadow
						is_rival = ROOT
						is_friend = ROOT
						is_lover = ROOT
						trait = chaste
						trait = sufi_zahid
					}
					OR = {
						AND = {
							is_female = no
							ROOT = { is_female = no }
						}
						AND = {
							is_female = yes
							ROOT = { is_female = yes }
						}
					}
				}
			}
			save_event_target_as = monastic_friend
		}
	}

	option = { #I will come as summoned.
		name = EVTOPTA_SUFI_4435	
		event_target:monastic_friend = {
			character_event = { id = SUFI.4436 days = 30 random = 30 }
		}
	}
}

#Ping Event for Monastic Friendship
character_event = {
	id = SUFI.4436
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:monastic_befriender = {
			character_event = { id = SUFI.4437 }
		}
	}
}

#Become closer with other member (Shared activity might lead to friendship? What to do?)
character_event = {
	id = SUFI.4437
	picture = GFX_evt_imam
	desc = {
		text = EVTDESC_SUFI_4437
		picture = GFX_evt_imam
		trigger = {	is_female = no }
	}
	desc = { 
		text = EVTDESC_SUFI_4437
		picture = GFX_evt_imam
		trigger = {	is_female = yes }
	}
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
	}


	immediate = {
		opinion = {
			who = FROM
			modifier = opinion_budding_friendship
		}
		FROM = {
			opinion = {
				who = ROOT
				modifier = opinion_budding_friendship
			}
		}
	}

	option = { #play a game of strategy
		name = EVTOPTA_SUFI_4437
		random = {
			chance = 75
			add_character_modifier = {
				modifier = played_strategy_game
				years = 5
			}
		}
		custom_tooltip = {
			text = monastic_may_become_friends
			hidden_tooltip = {
				event_target:monastic_friend = {
					if = {
						limit = {
							OR = {
								trait = misguided_warrior
								trait = tough_soldier
								trait = skilled_tactician
								trait = brilliant_strategist
							}
						}
						character_event = { id = SUFI.4438 days = 15 random = 15 }
					}
					if = {
						limit = {
							NOT = {
								trait = misguided_warrior
								trait = tough_soldier
								trait = skilled_tactician
								trait = brilliant_strategist
							}
						}
						character_event = { id = SUFI.4442 days = 15 random = 15 }
					}
				}
			}
		}
	}

	option = { #discuss the holy scripture
		name = EVTOPTB_SUFI_4437
		random = {
			chance = 75
			add_character_modifier = {
				modifier = discussed_scripture
				years = 5
			}
		}
		custom_tooltip = {
			text = monastic_may_become_friends
			hidden_tooltip = {
				event_target:monastic_friend = {
					if = {
						limit = {
							OR = {
								trait = detached_priest
								trait = martial_cleric
								trait = scholarly_theologian
								trait = mastermind_theologian
							}
						}
						character_event = { id = SUFI.4438 days = 15 random = 15 }
					}
					if = {
						limit = {
							NOT = {
								trait = detached_priest
								trait = martial_cleric
								trait = scholarly_theologian
								trait = mastermind_theologian
							}
						}
						character_event = { id = SUFI.4442 days = 15 random = 15 }
					}
				}
			}
		}
	}

	option = { #discuss the intricacies of managing a realm
		name = EVTOPTC_SUFI_4437
		random = {
			chance = 75
			add_character_modifier = {
				modifier = discussed_realm_management
				years = 5
			}
		}
		custom_tooltip = {
			text = monastic_may_become_friends
			hidden_tooltip = {
				event_target:monastic_friend = {
					if = {
						limit = {
							OR = {
								trait = indulgent_wastrel
								trait = thrifty_clerk
								trait = fortune_builder
								trait = midas_touched
							}
						}
						character_event = { id = SUFI.4438 days = 15 random = 15 }
					}
					if = {
						limit = {
							NOT = {
								trait = indulgent_wastrel
								trait = thrifty_clerk
								trait = fortune_builder
								trait = midas_touched
							}
						}
						character_event = { id = SUFI.4442 days = 15 random = 15 }
					}
				}
			}
		}
	}

	option = { #take a stroll while engaging in small talk
		name = EVTOPTD_SUFI_4437
		random = {
			chance = 75
			add_character_modifier = {
				modifier = took_stroll_small_talk
				years = 5
			}
		}
		custom_tooltip = {
			text = monastic_may_become_friends
			hidden_tooltip = {
				event_target:monastic_friend = {
					if = {
						limit = {
							OR = {
								trait = naive_appeaser
								trait = underhanded_rogue
								trait = charismatic_negotiator
								trait = grey_eminence
							}
						}
						character_event = { id = SUFI.4438 days = 15 random = 15 }
					}
					if = {
						limit = {
							NOT = {
								trait = naive_appeaser
								trait = underhanded_rogue
								trait = charismatic_negotiator
								trait = grey_eminence
							}
						}
						character_event = { id = SUFI.4442 days = 15 random = 15 }
					}
				}
			}
		}
	}
}

#Ping event for friendship established
character_event = {
	id = SUFI.4438
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:monastic_befriender = {
			if = {
				limit = {
					NOT = {
						is_rival = FROM
					}
				}
				character_event = { id = SUFI.4439 }
			}
		}
	}
}

#Friendship Established! Pursue it further, or focus on monastic duties?
character_event = {
	id = SUFI.4439
	picture = GFX_evt_imam
	desc = {
		text = EVTDESC_SUFI_4439
		picture = GFX_evt_imam
		trigger = {	is_female = no }
	}
	desc = { 
		text = EVTDESC_SUFI_4439
		picture = GFX_evt_imam
		trigger = {	is_female = yes }
	}
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
	}


	immediate = {
		remove_opinion = {
			who = FROM
			modifier = opinion_budding_friendship
		}
		FROM = {
			remove_opinion = {
				who = ROOT
				modifier = opinion_budding_friendship
			}
		}
		add_friend = FROM
	}

	option = { #Focus on monastic duties
		name = EVTOPTA_SUFI_4439
		ai_chance = {
			factor = 1
		}
		tooltip = {
			add_friend = FROM
		}
		piety = 25
		add_character_modifier = {
			modifier = focused_on_sufi_studies
			years = 10
		}
	}

	option = { #Pursue the friendship further
		name = EVTOPTB_SUFI_4439
		ai_chance = {
			factor = 1
			modifier = {
				factor = 3
				OR = {
					trait = depressed
					trait = stressed
				}
			}
			modifier = {
				factor = 0
				NOR = {
					trait = depressed
					trait = stressed
				}
			}
		}
		tooltip = {
			add_friend = FROM
		}
		custom_tooltip = {
			text = monastic_may_lead_to_more
			hidden_tooltip = {
				random_list = {
					10 = {
						modifier = {
							factor = 0
							OR = {
								trait = chaste
								trait = sufi_zahid
							}
						}
						event_target:monastic_friend = {
							character_event = { id = SUFI.4440 days = 30 random = 30 }
						}
					}
					10 = {
						modifier = {
							factor = 0
							trait = lustful
						}
					}
				}
			}
		}
		if = {
			limit = {
				OR = {
					trait = depressed
					trait = stressed
					NOT = { trait = gregarious }
				}
			}
			random_list = {
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = depressed }
					}
					remove_trait = depressed
				}
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = stressed }
					}
					remove_trait = stressed
				}
				10 = {
					modifier = {
						factor = 0
						trait = gregarious
					}
					modifier = {
						factor = 0
						trait = shy
					}
					add_trait = gregarious
					character_event = { id = 38265 }
				}
				10 = {
					modifier = {
						factor = 0
						trait = gregarious
					}
					modifier = {
						factor = 0
						NOT = { trait = shy }
					}
					remove_trait = shy
					character_event = { id = 38295 }
				}
				10 = {}
			}
		}
	}
}

#Ping event for 'tension'
character_event = {
	id = SUFI.4440
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:monastic_befriender = {
			character_event = { id = SUFI.4441 }
		}
	}
}

#Long lonely time without your spouse
character_event = {
	id = SUFI.4441
	picture = GFX_evt_imam
	desc = {
		text = EVTDESC_SUFI_4441
		picture = GFX_evt_imam
		trigger = {	is_female = no }
	}
	desc = { 
		text = EVTDESC_SUFI_4441
		picture = GFX_evt_imam
		trigger = {	is_female = yes }
	}
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
	}

	option = { #Suppress the urge
		name = EVTOPTA_SUFI_4441
		random_list = {
			10 = {
				modifier = {
					factor = 0
					trait = stressed
				}
				add_trait = stressed
				character_event = { id = 38282 }
			}
			# 10 = {
				# modifier = {
					# factor = 0
					# OR = {
						# trait = lustful
						# trait = chaste
					# }
				# }
				# add_trait = chaste
				# character_event = { id = 38274 }
			# }
			10 = {
				modifier = {
					factor = 0
					NOT = { trait = lustful }
				}
				remove_trait = lustful
			}
		}
	}

	option = { #Do it
		name = EVTOPTB_SUFI_4441
		add_trait = bisexual
		event_target:monastic_friend = {
			add_trait = bisexual
			set_character_flag = monastic_friend_lover_@ROOT
		}
		add_lover = FROM
		hidden_effect = {
			remove_friend = FROM
		}
	}
}

#Ping event for friendship not established
character_event = {
	id = SUFI.4442
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:monastic_befriender = {
			character_event = { id = SUFI.4443 }
		}
	}
}

#Friendship not established notification
character_event = {
	id = SUFI.4443
	picture = GFX_evt_imam
	desc = {
		text = EVTDESC_SUFI_4443
		picture = GFX_evt_imam
		trigger = {	is_female = no }
	}
	desc = { 
		text = EVTDESC_SUFI_4443
		picture = GFX_evt_imam
		trigger = {	is_female = yes }
	}
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
	}

	immediate = {
		remove_opinion = {
			who = FROM
			modifier = opinion_budding_friendship
		}
		FROM = {
			remove_opinion = {
				who = ROOT
				modifier = opinion_budding_friendship
			}
		}
	}

	option = {
		name = EVTOPTA_SUFI_4443
	}
}

## Monastery has Artifact: To Steal or not to Steal? #

#Starter Event for Monastery has Artifact
character_event = {
	id = SUFI.4610
	picture = GFX_evt_relic_box
	desc = EVTDESC_SUFI_4610
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	only_capable = yes
	only_playable = yes
	religion_group = muslim
	
	trigger = {
		is_sufi_member_trigger = yes
		NOT = { is_inaccessible_trigger = yes }
		NOT = { has_character_modifier = caught_stealing_artifact_penance }
		NOT = {	has_character_flag = monastic_stole_artifact }
	}

	immediate = {
		save_event_target_as = monastic_artifact_stealer
		random_list = {
			25 = {
				modifier = {
					factor = 0
					has_artifact = ancient_quran
				}
				set_character_flag = monastic_artifact_ancient_quran
			}
			25 = {
				modifier = {
					factor = 0
					has_artifact = fine_calligraphy
				}
				set_character_flag = monastic_artifact_fine_calligraphy
			}
			25 = {
				modifier = {
					factor = 0
					has_artifact = ceremonial_scimitar
				}
				set_character_flag = monastic_artifact_ceremonial_scimitar
			}
			25 = {
				modifier = {
					factor = 0
					has_artifact = old_world_prayer_mat
				}
				set_character_flag = monastic_artifact_old_world_prayer_mat
			}
		}
	}

	option = { #That's nice I guess
		name = EVTOPTA_SUFI_4610
		random = {
			chance = 25
			if = {
				limit = {
					trait = ambitious
				}
				remove_trait = ambitious
			}
			if = {
				limit = {
					NOT = { trait = ambitious }
					NOT = { trait = content }
				}
				add_trait = content
				character_event = { id = 38279 }
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				trait = mystic
			}
		}
	}

	option = { #Pay for a celebration
		name = EVTOPTB_SUFI_4610
		scaled_wealth = { value = -0.5 min = -50 }
		custom_tooltip = { text = EVTOPTB_SUFI_4610_TT }
		hidden_effect = {
			character_event = { id = SUFI.4618 days = 15 random = 30 }
		}
		ai_chance = {
			factor = 45
			modifier = {
				factor = 2
				trait = charitable
			}
			modifier = {
				factor = 2
				trait = mystic
			}
		}
	}

	option = { #Steal it!
		name = EVTOPTC_SUFI_4610
		random = {
			chance = 50
			if = {
				limit = {
					NOT = { trait = ambitious }
					NOT = { trait = content }
				}
				add_trait = ambitious
				character_event = { id = 38278 }
			}
			if = {
				limit = {
					trait = content
				}
				remove_trait = content
				character_event = { id = 38299 }
			}
		}
		hidden_effect = {
			character_event = { id = SUFI.4611 days = 15 random = 30 }
		}
		trigger_switch = {
			on_trigger = has_character_flag
			monastic_artifact_ancient_quran = { custom_tooltip = { text = EVTOPTC_SUFI_4610_ancient_quran } }
			monastic_artifact_fine_calligraphy = { custom_tooltip = { text = EVTOPTC_SUFI_4610_fine_calligraphy } }
			monastic_artifact_ceremonial_scimitar = { custom_tooltip = { text = EVTOPTC_SUFI_4610_ceremonial_scimitar } }
			monastic_artifact_old_world_prayer_mat = { custom_tooltip = { text = EVTOPTC_SUFI_4610_old_world_prayer_mat } }
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = cynical
			}
		}
	}
}

#Monastic Artifact: planning for the theft
character_event = {
	id = SUFI.4611
	picture = GFX_evt_shady_meeting
	desc = EVTDESC_SUFI_4611
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		society = {
			random_society_member = {
				limit = {
					ai = yes
					is_lover = ROOT
					has_character_flag = monastic_friend_lover_@ROOT
					OR = {
						AND = {
							is_female = no
							ROOT = { is_female = no }
						}
						AND = {
							is_female = yes
							ROOT = { is_female = yes }
						}
					}
				}
				save_event_target_as = monastic_artifact_lover
			}
		}
	}

	option = { #Grab it and run
		name = EVTOPTA_SUFI_4611
		custom_tooltip = { text = EVTOPTA_SUFI_4611_TT }
		hidden_effect = {
			if = {
				limit = {
					NOT = { martial = 10 }
				}
				random_list = {
					5= {
						character_event = { id = SUFI.4617 days = 15 random = 30 } #success
					}
					95 = {
						character_event = { id = SUFI.4612 days = 15 random = 30 } #failure
					}
				}
			}
			if = {
				limit = {
					AND = {
						martial = 10
						NOT = { martial = 14 }
					}
				}
				random_list = {
					10 = {
						character_event = { id = SUFI.4617 days = 15 random = 30 } #success
					}
					90 = {
						character_event = { id = SUFI.4612 days = 15 random = 30 } #failure
					}
				}
			}
			if = {
				limit = {
					AND = {
						martial = 14
						NOT = { martial = 18 }
					}
				}
				random_list = {
					15 = {
						character_event = { id = SUFI.4617 days = 15 random = 30 } #success
					}
					85 = {
						character_event = { id = SUFI.4612 days = 15 random = 30 } #failure
					}
				}
			}
			if = {
				limit = {
					AND = {
						martial = 18
						NOT = { martial = 22 }
					}
				}
				random_list = {
					20 = {
						character_event = { id = SUFI.4617 days = 15 random = 30 } #success
					}
					80 = {
						character_event = { id = SUFI.4612 days = 15 random = 30 } #failure
					}
				}
			}
			if = {
				limit = {
					martial = 22
				}
				random_list = {
					25 = {
						character_event = { id = SUFI.4617 days = 15 random = 30 } #success
					}
					75 = {
						character_event = { id = SUFI.4612 days = 15 random = 30 } #failure
					}
				}
			}
		}
	}

	option = { #Bribe Abbot
		name = EVTOPTB_SUFI_4611
		scaled_wealth = { value = -3 min = -300 }
		custom_tooltip = { text = EVTOPTB_SUFI_4611_TT }
		hidden_effect = {
			random_list = {
				95 = {
					character_event = { id = SUFI.4617 days = 15 random = 30 } #success
				}
				5 = {
					character_event = { id = SUFI.4612 days = 15 random = 30 } #failure
				}
			}
		}
	}

	option = { #Trick everyone
		trigger = {
			intrigue = 18
		}

		name = EVTOPTC_SUFI_4611
		custom_tooltip = { text = EVTOPTC_SUFI_4611_TT }
		hidden_effect = {
			random_list = {
				50 = {
					character_event = { id = SUFI.4617 days = 15 random = 30 } #success
				}
				50 = {
					character_event = { id = SUFI.4612 days = 15 random = 30 } #failure
				}
			}
		}
	}

	option = { #Get lover to help
		trigger = {
			society = {
				any_society_member = {
					ai = yes
					is_lover = ROOT
					has_character_flag = monastic_friend_lover_@ROOT
					OR = {
						AND = {
							is_female = no
							ROOT = { is_female = no }
						}
						AND = {
							is_female = yes
							ROOT = { is_female = yes }
						}
					}
				}
			}
		}
		custom_tooltip = { text = EVTOPTD_SUFI_4611_TT }
		name = EVTOPTD_SUFI_4611
		hidden_effect = {
			set_character_flag = monastic_artifact_lover
			random_list = {
				25 = {
					character_event = { id = SUFI.4617 days = 15 random = 30 } #success
				}
				75 = {
					character_event = { id = SUFI.4612 days = 15 random = 30 } #failure
				}
			}
		}
		event_target:monastic_artifact_lover = {
			show_portrait = yes
		}
	}
}

#Initial ping event for failure event / getting caught
character_event = {
	id = SUFI.4612
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		society = {
			random_society_member = {
				limit = {
					NOT = { is_society_grandmaster = yes }
					NOT = { is_friend = ROOT }
					NOT = { is_lover = ROOT }
					ai = yes
				}
				save_event_target_as = monastic_artifact_witness
				character_event = { id = SUFI.4613 }
			}
		}
	}
}

#Second ping event for failure event / getting caught
character_event = {
	id = SUFI.4613
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		random_list = {
			40 = {
				event_target:monastic_artifact_stealer = {
					character_event = { id = SUFI.4614 }
				}
			}
			60 = {
				modifier = {
					factor = 0
					NOT = { event_target:monastic_artifact_stealer = { has_character_flag = monastic_artifact_lover } }
				}
				event_target:monastic_artifact_stealer = {
					character_event = { id = SUFI.4616 }
				}
			}
		}
	}
}

#Monastic Artifact failure: got caught red-handed!
character_event = {
	id = SUFI.4614
	picture = GFX_evt_eavesdropping
	desc = EVTDESC_SUFI_4614
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		add_character_modifier = { name = caught_red_handed years = 5 }
	}

	option = { #surrender
		name = EVTOPTA_SUFI_4614
		custom_tooltip = { text = EVTOPTA_SUFI_4614_TT }
		add_character_modifier = { name = caught_stealing_artifact_penance years = 10 }
		hidden_effect = {
			society = {
				any_society_member = {
					opinion = {
						who = ROOT
						modifier = stole_artifact_penance
						years = 10
					}
				}
			}
		}
	}

	option = { #rush past them
		name = EVTOPTB_SUFI_4614
		custom_tooltip = { text = EVTOPTB_SUFI_4614_TT }
		set_character_flag = flag_monastic_mid_theft #Prevents on_leave_society cleanup event to clear the artifact flags when leaving the society.
		hidden_effect = {
			society = {
				any_society_member = {
					opinion = {
						who = ROOT
						modifier = stole_artifact
						years = 20
					}
				}
			}
		}
		if = {
			limit = {
				society_member_of = monastic_order_sunni
			}
			leave_society = yes
			hidden_effect = {
				set_character_flag = betrayed_monastic_order_sunni
			}
		}
		if = {
			limit = {
				society_member_of = monastic_order_shiite
			}
			leave_society = yes
			hidden_effect = {
				set_character_flag = betrayed_monastic_order_shiite
			}
		}
		if = {
			limit = {
				society_member_of = monastic_order_ibadi
			}
			leave_society = yes
			hidden_effect = {
				set_character_flag = betrayed_monastic_order_ibadi
			}
		}
		character_event = { id = SUFI.4615 days = 10 random = 10 }
	}

	option = { #Leave no witnesses!
		name = EVTOPTC_SUFI_4614
		if = {
			limit = {
				trait = temperate
			}
			remove_trait = temperate
		}
		if = {
			limit = {
				NOT = { trait = greedy }
				NOT = { trait = temperate }
			}
			add_trait = greedy
		}
		custom_tooltip = { text = EVTOPTC_SUFI_4614_TT }
		if = {
			limit = {
				combat_rating_diff = { who = event_target:monastic_artifact_witness value = 5 }
			}
			custom_tooltip = { text = holmgang_chances_great } #Tooltip reuse FTW
			hidden_tooltip = {
				random_list = {
					84 = {
						character_event = { id = SUFI.4619 days = 0 }
					}
					10 = {
						character_event = { id = SUFI.4620 days = 0 }
					}
					5 = {
						character_event = { id = SUFI.4621 days = 0 }
					}
					1 = {
						character_event = { id = SUFI.4622 days = 0 }
					}
				}
			}
			break = yes
		}
		if = {
			limit = {
				combat_rating_diff = { who = event_target:monastic_artifact_witness value = 3 }
				NOT = {
					combat_rating_diff = { who = event_target:monastic_artifact_witness value = 5 }
				}
			}
			custom_tooltip = { text = holmgang_chances_very_good }
			hidden_tooltip = {
				random_list = {
					70 = {
						character_event = { id = SUFI.4619 days = 0 }
					}
					15 = {
						character_event = { id = SUFI.4620 days = 0 }
					}
					10 = {
						character_event = { id = SUFI.4621 days = 0 }
					}
					5 = {
						character_event = { id = SUFI.4622 days = 0 }
					}
				}
			}
			break = yes
		}
		if = {
			limit = {
				combat_rating_diff = { who = event_target:monastic_artifact_witness value = 1 }
				NOT = {
					combat_rating_diff = { who = event_target:monastic_artifact_witness value = 3 }
				}
			}
			custom_tooltip = { text = holmgang_chances_good }
			hidden_tooltip = {
				random_list = {
					60 = {
						character_event = { id = SUFI.4619 days = 0 }
					}
					20 = {
						character_event = { id = SUFI.4620 days = 0 }
					}
					15 = {
						character_event = { id = SUFI.4621 days = 0 }
					}
					5 = {
						character_event = { id = SUFI.4622 days = 0 }
					}
				}
			}
			break = yes
		}
		if = {
			limit = {
				NOT = {
					combat_rating_diff = { who = event_target:monastic_artifact_witness value = 1 }
					event_target:monastic_artifact_witness = {
						combat_rating_diff = { who = ROOT value = 1 }
					}
				}
			}
			custom_tooltip = { text = holmgang_chances_even }
			hidden_tooltip = {
				random_list = {
					20 = {
						character_event = { id = SUFI.4619 days = 0 }
					}
					20 = {
						character_event = { id = SUFI.4620 days = 0 }
					}
					20 = {
						character_event = { id = SUFI.4621 days = 0 }
					}
					40 = {
						character_event = { id = SUFI.4622 days = 0 }
					}
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:monastic_artifact_witness = {
					combat_rating_diff = { who = ROOT value = 1 }
				}
				NOT = {
					event_target:monastic_artifact_witness = {
						combat_rating_diff = { who = ROOT value = 3 }
					}
				}
			}
			custom_tooltip = { text = holmgang_chances_poor }
			hidden_tooltip = {
				random_list = {
					5 = {
						character_event = { id = SUFI.4619 days = 0 }
					}
					15 = {
						character_event = { id = SUFI.4620 days = 0 }
					}
					20 = {
						character_event = { id = SUFI.4621 days = 0 }
					}
					60 = {
						character_event = { id = SUFI.4622 days = 0 }
					}
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:monastic_artifact_witness = {
					combat_rating_diff = { who = ROOT value = 3 }
				}
				NOT = {
					event_target:monastic_artifact_witness = {
						combat_rating_diff = { who = ROOT value = 5 }
					}
				}
			}
			custom_tooltip = { text = holmgang_chances_very_poor }
			hidden_tooltip = {
				random_list = {
					1 = {
						character_event = { id = SUFI.4619 days = 0 }
					}
					4 = {
						character_event = { id = SUFI.4620 days = 0 }
					}
					15 = {
						character_event = { id = SUFI.4621 days = 0 }
					}
					80 = {
						character_event = { id = SUFI.4622 days = 0 }
					}
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:monastic_artifact_witness = {
					combat_rating_diff = { who = ROOT value = 5 }
				}
			}
			custom_tooltip = { text = holmgang_chances_terrible }
			hidden_tooltip = {
				random_list = {					
					1 = {
						character_event = { id = SUFI.4620 days = 0 }
					}
					9 = {
						character_event = { id = SUFI.4621 days = 0 }
					}
					90 = {
						character_event = { id = SUFI.4622 days = 0 }
					}
				}
			}
			break = yes
		}
	}
}

character_event = { # win - no wound
	id = SUFI.4619
	desc = EVTDESC_SUFI_4619
	border = GFX_event_normal_frame_religion
	picture = GFX_evt_assassination

	is_triggered_only = yes

	immediate = {
		society = {
			random_society_member = {
				limit = {
					NOT = { is_society_grandmaster = yes }
					NOT = { is_friend = ROOT }
					NOT = { is_lover = ROOT }
					OR = {
						trait = greedy
						trait = deceitful
					}
					ai = yes
				}
				save_event_target_as = monastic_artifact_blackmailer
			}
		}
	}

	option = {
		name = EVTOPTA_SUFI_4619
		event_target:monastic_artifact_witness = {
			save_event_target_as = target_victim
			death = { death_reason = death_murder_unknown killer = ROOT }
		}
		trigger_switch = {
			on_trigger = has_character_flag
			monastic_artifact_ancient_quran = { add_artifact = ancient_quran }
			monastic_artifact_fine_calligraphy = { add_artifact = fine_calligraphy }
			monastic_artifact_ceremonial_scimitar = { add_artifact = ceremonial_scimitar }
			monastic_artifact_old_world_prayer_mat = { add_artifact = old_world_prayer_mat }
		}
		hidden_effect = {
			set_character_flag = monastic_stole_artifact
			if = {
				limit = {
					NOT = { intrigue = 6 }
				}
				random_list = {
					75 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					25 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 6
						NOT = { intrigue = 10 }
					}
				}
				random_list = {
					50 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					50 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 10
						NOT = { intrigue = 14 }
					}
				}
				random_list = {
					40 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					60 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 14
						NOT = { intrigue = 18 }
					}
				}
				random_list = {
					30 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					70 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 18
						NOT = { intrigue = 22 }
					}
				}
				random_list = {
					20 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					80 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					intrigue = 22
				}
				random_list = {
					10 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					90 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
		}
	}
}

character_event = { # win - wound
	id = SUFI.4620
	desc = EVTDESC_SUFI_4620
	border = GFX_event_normal_frame_religion
	picture = GFX_evt_assassination

	is_triggered_only = yes

	trigger = { is_sufi_member_trigger = yes }

	option = {
		name = EVTOPTA_SUFI_4620
		event_target:monastic_artifact_witness = {
			death = { death_reason = death_murder_unknown killer = ROOT }
		}
		add_trait_wounded_effect = yes
		trigger_switch = {
			on_trigger = has_character_flag
			monastic_artifact_ancient_quran = { add_artifact = ancient_quran }
			monastic_artifact_fine_calligraphy = { add_artifact = fine_calligraphy }
			monastic_artifact_ceremonial_scimitar = { add_artifact = ceremonial_scimitar }
			monastic_artifact_old_world_prayer_mat = { add_artifact = old_world_prayer_mat }
		}
		hidden_effect = {
			set_character_flag = monastic_stole_artifact
			if = {
				limit = {
					NOT = { intrigue = 6 }
				}
				random_list = {
					75 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					25 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 6
						NOT = { intrigue = 10 }
					}
				}
				random_list = {
					50 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					50 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 10
						NOT = { intrigue = 14 }
					}
				}
				random_list = {
					40 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					60 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 14
						NOT = { intrigue = 18 }
					}
				}
				random_list = {
					30 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					70 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 18
						NOT = { intrigue = 22 }
					}
				}
				random_list = {
					20 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					80 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					intrigue = 22
				}
				random_list = {
					10 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					90 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
		}
	}
}

character_event = { # win - maimed
	id = SUFI.4621
	desc = EVTDESC_SUFI_4621
	border = GFX_event_normal_frame_religion
	picture = GFX_evt_assassination

	is_triggered_only = yes

	trigger = { is_sufi_member_trigger = yes }

	option = {
		name = EVTOPTA_SUFI_4621
		event_target:monastic_artifact_witness = {
			death = { death_reason = death_murder_unknown killer = ROOT }
		}
		if = {
			limit = {
				can_be_maimed_trigger = yes
			}
			add_maimed_trait_effect = yes
		}
		else = {
			add_trait_wounded_effect = yes
		}
		trigger_switch = {
			on_trigger = has_character_flag
			monastic_artifact_ancient_quran = { add_artifact = ancient_quran }
			monastic_artifact_fine_calligraphy = { add_artifact = fine_calligraphy }
			monastic_artifact_ceremonial_scimitar = { add_artifact = ceremonial_scimitar }
			monastic_artifact_old_world_prayer_mat = { add_artifact = old_world_prayer_mat }
		}
		hidden_effect = {
			set_character_flag = monastic_stole_artifact
			if = {
				limit = {
					NOT = { intrigue = 6 }
				}
				random_list = {
					80 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					20 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 6
						NOT = { intrigue = 10 }
					}
				}
				random_list = {
					60 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					40 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 10
						NOT = { intrigue = 14 }
					}
				}
				random_list = {
					50 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					50 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 14
						NOT = { intrigue = 18 }
					}
				}
				random_list = {
					40 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					60 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					AND = {
						intrigue = 18
						NOT = { intrigue = 22 }
					}
				}
				random_list = {
					30 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					70 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
			if = {
				limit = {
					intrigue = 22
				}
				random_list = {
					20 = {
						event_target:monastic_artifact_blackmailer = {
							character_event = { id = SUFI.4623 days = 90 random = 30 } #someone figures it out
						}
					}
					80 = {
						hidden_effect = {
							clr_character_flag = monastic_artifact_lover
							clr_character_flag = monastic_artifact_ancient_quran
							clr_character_flag = monastic_artifact_fine_calligraphy
							clr_character_flag = monastic_artifact_ceremonial_scimitar
							clr_character_flag = monastic_artifact_old_world_prayer_mat
						}
					}
				}
			}
		}
	}
}

character_event = { # loss - death
	id = SUFI.4622
	desc = EVTDESC_SUFI_4622
	border = GFX_event_normal_frame_religion
	picture = GFX_evt_beheading

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SUFI_4622
		death = { death_reason = death_duel killer = event_target:monastic_artifact_witness }
	}
}

#Ran off with it despite leaving witnesses
character_event = {
    id = SUFI.4615
    desc = EVTDESC_SUFI_4615
    picture = GFX_evt_uncomfortable
    border = GFX_event_normal_frame_religion
    
    is_triggered_only = yes

    option = {
    	name = EVTOPTA_SUFI_4615
    	trigger_switch = {
			on_trigger = has_character_flag
			monastic_artifact_ancient_quran = { add_artifact = ancient_quran }
			monastic_artifact_fine_calligraphy = { add_artifact = fine_calligraphy }
			monastic_artifact_ceremonial_scimitar = { add_artifact = ceremonial_scimitar }
			monastic_artifact_old_world_prayer_mat = { add_artifact = old_world_prayer_mat }
		}
		hidden_effect = {
			set_character_flag = monastic_stole_artifact
			clr_character_flag = monastic_artifact_lover
			clr_character_flag = monastic_artifact_ancient_quran
			clr_character_flag = monastic_artifact_fine_calligraphy
			clr_character_flag = monastic_artifact_ceremonial_scimitar
			clr_character_flag = monastic_artifact_old_world_prayer_mat
		}
    }
}

#Lover stops witness letting you escape
character_event = {
	id = SUFI.4616
	desc = EVTDESC_SUFI_4616
    picture = GFX_evt_eavesdropping
    border = GFX_event_normal_frame_religion
    
    is_triggered_only = yes

    trigger = { is_sufi_member_trigger = yes }

    option = {
    	name = EVTOPTA_SUFI_4616
    	trigger_switch = {
			on_trigger = has_character_flag
			monastic_artifact_ancient_quran = { add_artifact = ancient_quran }
			monastic_artifact_fine_calligraphy = { add_artifact = fine_calligraphy }
			monastic_artifact_ceremonial_scimitar = { add_artifact = ceremonial_scimitar }
			monastic_artifact_old_world_prayer_mat = { add_artifact = old_world_prayer_mat }
		}
		hidden_effect = {
			set_character_flag = monastic_stole_artifact
			clr_character_flag = monastic_artifact_lover
			clr_character_flag = monastic_artifact_ancient_quran
			clr_character_flag = monastic_artifact_fine_calligraphy
			clr_character_flag = monastic_artifact_ceremonial_scimitar
			clr_character_flag = monastic_artifact_old_world_prayer_mat
		}
    }
}

#Stole the artifact without any witnesses!
character_event = {
	id = SUFI.4617
	desc = EVTDESC_SUFI_4617
    picture = GFX_evt_relic_box
    border = GFX_event_normal_frame_religion
    
    is_triggered_only = yes

	trigger = { is_sufi_member_trigger = yes }

    option = {
    	name = EVTOPTA_SUFI_4617
    	trigger_switch = {
			on_trigger = has_character_flag
			monastic_artifact_ancient_quran = { add_artifact = ancient_quran }
			monastic_artifact_fine_calligraphy = { add_artifact = fine_calligraphy }
			monastic_artifact_ceremonial_scimitar = { add_artifact = ceremonial_scimitar }
			monastic_artifact_old_world_prayer_mat = { add_artifact = old_world_prayer_mat }
		}
		hidden_effect = {
			set_character_flag = monastic_stole_artifact
			clr_character_flag = monastic_artifact_lover
			clr_character_flag = monastic_artifact_ancient_quran
			clr_character_flag = monastic_artifact_fine_calligraphy
			clr_character_flag = monastic_artifact_ceremonial_scimitar
			clr_character_flag = monastic_artifact_old_world_prayer_mat
		}
    }
}

#Celebrate the artifact
character_event = {
	id = SUFI.4618
	desc = EVTDESC_SUFI_4618
    picture = GFX_evt_charity
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes
	
	trigger = { is_sufi_member_trigger = yes }

    option = {
    	name = EVTOPTA_SUFI_4618
    	add_character_modifier = { name = artifact_patron years = 5 }
    	custom_tooltip = { text = society_pleased_with_celebration }
    	hidden_effect = {
    		society = {
				any_society_member = {
					opinion = {
						who = ROOT
						modifier = paid_for_celebration_artifact
						years = 5
					}
				}
			}
		}
    }
}

#Ping event for someone piecing it together
character_event = {
	id = SUFI.4623
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:monastic_artifact_stealer = {
			letter_event = { id = SUFI.4624 }
		}
	}
}

#Someone pieced it together
letter_event = {
	id = SUFI.4624
	desc = EVTDESC_SUFI_4624
    picture = GFX_evt_shady_meeting
    border = GFX_event_letter_frame_religion

    is_triggered_only = yes

    trigger = { is_sufi_member_trigger = yes }

    option = { #Bribe them!
    	name = EVTOPTA_SUFI_4624
    	transfer_scaled_wealth = {
    		to = FROM
    		value = 3
    		min = 300
    	}
    }
    option = { #Return the artifact and pay them to keep quiet
    	trigger = {
    		OR = {
    			AND = {
    				has_character_flag = monastic_artifact_ancient_quran
    				has_artifact = ancient_quran
    			}
    			AND = {
    				has_character_flag = monastic_artifact_fine_calligraphy
    				has_artifact = fine_calligraphy
    			}
    			AND = {
    				has_character_flag = monastic_artifact_ceremonial_scimitar
    				has_artifact = ceremonial_scimitar
    			}
    			AND = {
    				has_character_flag = monastic_artifact_old_world_prayer_mat
    				has_artifact = old_world_prayer_mat
    			}
    		}
    	}
    	name = EVTOPTB_SUFI_4624
    	transfer_scaled_wealth = {
    		to = FROM
    		value = 1
    		min = 100
    	}
    	trigger_switch = {
			on_trigger = has_character_flag
			monastic_artifact_ancient_quran = {
				destroy_artifact = ancient_quran
			}
			monastic_artifact_fine_calligraphy = {
				destroy_artifact = fine_calligraphy
			}
			monastic_artifact_ceremonial_scimitar = {
				destroy_artifact = ceremonial_scimitar
			}
			monastic_artifact_old_world_prayer_mat = {
				destroy_artifact = old_world_prayer_mat
			}
		}
    }
    option = { #Keep it!
    	name = EVTOPTC_SUFI_4624
    	custom_tooltip = { text = EVTOPTC_SUFI_4624_TT }
    	if = {
    		limit = {
    			has_character_flag = monastic_artifact_lover
    		}
    		custom_tooltip = { text = EVTOPTC_SUFI_4624_2_TT }
    		event_target:monastic_artifact_lover = {
				show_portrait = yes
			}
    	}
    	tooltip = {
    		add_character_modifier = {
				name = known_murderer
				years = 50
			}
		}
    	hidden_effect = {
    		character_event = { id = 10 }
    		random = {
    			chance = 75
    			if = {
    				limit = {
    					has_character_flag = monastic_artifact_lover
    				}
    				event_target:monastic_artifact_lover = {
    					character_event = { id = SUFI.4625 }
    				}
    			}
    		}
			society = {
				any_society_member = {
					opinion = {
						who = ROOT
						modifier = stole_artifact
						years = 20
					}
				}
			}
		}
		if = {
			limit = {
				society_member_of = monastic_order_sunni
			}
			leave_society = yes
			hidden_effect = {
				set_character_flag = betrayed_monastic_order_sunni
			}
		}
		if = {
			limit = {
				society_member_of = monastic_order_shiite
			}
			leave_society = yes
			hidden_effect = {
				set_character_flag = betrayed_monastic_order_shiite
			}
		}
		if = {
			limit = {
				society_member_of = monastic_order_ibadi
			}
			leave_society = yes
			hidden_effect = {
				set_character_flag = betrayed_monastic_order_ibadi
			}
		}
    }
    after = {
    	hidden_effect = {
			clr_character_flag = monastic_artifact_lover
			clr_character_flag = monastic_artifact_ancient_quran
			clr_character_flag = monastic_artifact_fine_calligraphy
			clr_character_flag = monastic_artifact_ceremonial_scimitar
			clr_character_flag = monastic_artifact_old_world_prayer_mat
		}
    }
}

#Ping event for lover suicide
character_event = {
	id = SUFI.4625
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:monastic_artifact_stealer = {
			letter_event = { id = SUFI.4626 days = 5 random = 10 }
		}
	}
}

#Lover commits suicide
character_event = {
	id = SUFI.4626
	picture = GFX_evt_bad_news

    trigger = { is_sufi_member_trigger = yes }

	desc = {
		text = EVTDESC_SUFI_4626
		picture = GFX_evt_bad_news
		trigger = {	is_female = no }
	}
	desc = { 
		text = EVTDESC_SUFI_4626
		picture = GFX_evt_bad_news_female
		trigger = {	is_female = yes }
	}
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
    	name = EVTOPTA_SUFI_4626
    	event_target:monastic_artifact_lover = {
    		death = { death_reason = death_suicide_hanging }
    	}
    }
}

############################################
####   Advising a Poet: Hidden start    ####
############################################
character_event = {
    id = SUFI.3260
    hide_window = yes
	
	is_in_society = yes
	capable_only = yes
	prisoner = no
	min_age = 16
	religion_group = muslim
    
    is_triggered_only = yes

    trigger = {
    	is_sufi_member_trigger = yes

    	NOT = { has_character_modifier = patron_of_the_arts }
		NOT = { has_character_modifier = preserver_of_poetry }
		NOT = { has_character_modifier = published_poet }

    	society = {
		    any_society_member = {
	            ai = yes
	            is_incapable = no
	            prisoner = no
	            in_command = no
	            is_inaccessible_trigger = no
	            OR = {
					trait = poet
					learning = 15
					diplomacy = 15
	            }
	            NOT = { character = ROOT }
	            is_within_diplo_range = ROOT
	        }
	    }	
    }
       
    immediate = {
        # First look for someone at court
        society = {
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
                    OR = {
						trait = poet
						learning = 15
						diplomacy = 15
		            }
                    NOT = { character = ROOT }
                    host = { character = ROOT }
                }
                character_event = { id = SUFI.3261 }
                break = yes
            }
            
            # Then look for someone in the same realm
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
                    OR = {
						trait = poet
						learning = 15
						diplomacy = 15
		            }
                    NOT = { character = ROOT }
                    same_realm = yes
                }
                character_event = { id = SUFI.3261 }
                break = yes
            }
            
            # Then look abroad...
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
                    OR = {
						trait = poet
						learning = 15
						diplomacy = 15
		            }
                    NOT = { character = ROOT }
                    is_within_diplo_range = ROOT
                }
                character_event = { id = SUFI.3261 }
                break = yes
            }
        }
    }
}


#Ping event for other member (the poet)
character_event = {
    id = SUFI.3261
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { character_event = { id = SUFI.3262 } } }
}

# A fellow member seeks your advice on some writing of theirs
character_event = {
    id = SUFI.3262
    desc = EVTDESC_SUFI_3262
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes
    
    trigger = {
    	FROM = { is_alive = yes }
    }

    option = { #Highlight X
        name = EVTOPTA_SUFI_3262
        custom_tooltip = { text = EVTOPTA_SUFI_3262_TT }
        set_character_flag = suggestion_A_flag
        hidden_effect = { FROM = { character_event = { id = SUFI.3263 days = 15 random = 30 } } } #send new ping
    }
    option = { #Go more in Y direction
        name = EVTOPTB_SUFI_3262
        custom_tooltip = { text = EVTOPTA_SUFI_3262_TT }
        set_character_flag = suggestion_B_flag
        hidden_effect = { FROM = { character_event = { id = SUFI.3263 days = 15 random = 30 } } } #send new ping
    }
    option = { # Writing is frivolous and dumb / opt out
        name = EVTOPTC_SUFI_3262
        custom_tooltip = { text = EVTOPTC_SUFI_3262_TT }

        reverse_opinion = {
            who = FROM
            modifier = opinion_disappointed
            years = 10
        }
    }
}

#Ping event for other member (the poet)
character_event = {
    id = SUFI.3263
    hide_window = yes
    is_triggered_only = yes
    trigger = { is_alive = yes }
    immediate = { FROM = { character_event = { id = SUFI.3264 } } }
}

character_event = {
    id = SUFI.3264
    desc = EVTDESC_SUFI_3264
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes
    
    trigger = {
    	FROM = { is_alive = yes }
    	is_sufi_member_trigger = yes
    }

    option = { # This should be published! (The writer will NOT be pleased)
        name = EVTOPTA_SUFI_3264
        custom_tooltip = { text = EVTOPTA_SUFI_3264_TT }
        set_character_flag = 3264_publish_flag
        wealth = -55

        add_character_modifier = {
            name = patron_of_the_arts
            years = 10
        }
    }
    option = { # Our Order will preserve these words for generations (The writer will be pleased)
        name = EVTOPTB_SUFI_3264
        custom_tooltip = { text = EVTOPTB_SUFI_3264_TT }
        set_character_flag = 3264_preserve_flag
        
        add_character_modifier = {
            name = preserver_of_poetry
            years = 10
        }
    }
    option = { # DEPRESSED - FEEL BETTER
        name = EVTOPTC_SUFI_3264
        custom_tooltip = { text = EVTOPTC_SUFI_3264_TT }
        random = {
            chance = 25
			remove_trait = depressed
            hidden_tooltip = {
				character_event = { id = 38314 days = 1 } # Notify lost Depressed
			}
        }
        set_character_flag = 3264_depressed_flag
        tooltip_info = depressed
        trigger = { trait = depressed }
    }
    option = { # DECEITFUL - STEAL TEXT
        name = EVTOPTD_SUFI_3264
        custom_tooltip = { text = EVTOPTD_SUFI_3264_TT }

        piety = -50

        set_character_flag = 3264_deceitful_flag
        add_character_modifier = {
            name = published_poet
            years = 15
        }
        tooltip_info = deceitful
        trigger = { trait = deceitful }
    }
    after = {
    	hidden_effect = { FROM = { character_event = { id = SUFI.3265 days = 20 random = 10 } } } #send new ping
    }
}

#Ping event for other member (the poet)
character_event = {
    id = SUFI.3265
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = {
	    	trigger_switch = { # Which event to send
	            on_trigger = has_character_flag
	            3264_publish_flag = {
	                character_event = { id = SUFI.3266 }
	                clr_character_flag = 3264_publish_flag
	            }
	            3264_preserve_flag = {
	                character_event = { id = SUFI.3267 }
	                clr_character_flag = 3264_preserve_flag
	            }
	            3264_depressed_flag = {
			    	character_event = { id = SUFI.3268 }
	                clr_character_flag = 3264_depressed_flag
	            }
	            3264_deceitful_flag = {
			    	character_event = { id = SUFI.3269 }
	                clr_character_flag = 3264_deceitful_flag
	            }
	        }
	    }
        if = {
        	limit = { NOT = { trait = poet } }
        	add_trait = poet
        }
    }
}


# The writer's reaction - PUBLISHED AGAINST THEIR WISHES
character_event = {
    id = SUFI.3266
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes
    
    trigger = {
    	FROM = { is_alive = yes }
    }

	desc = {
		trigger = { has_character_flag = suggestion_A_flag }
		text = EVTDESC_SUFI_3266_A
    }
    desc = {
        trigger = { has_character_flag = suggestion_B_flag }
        text = EVTDESC_SUFI_3266_B
    }

    option = { # I seized an opportunity
        name = EVTOPTA_SUFI_3266
        custom_tooltip = { text = EVTOPTA_SUFI_3266_TT }

        reverse_opinion = {
            who = FROM
            modifier = opinion_insulted
            years = 10
        }
        hidden_effect = { character_event = { id = SUFI.3270 } } #clean up
    }
}

# The writer's reaction - WRITINGS WILL BE SENT TO THE ORDER
character_event = {
    id = SUFI.3267
    desc = EVTDESC_SUFI_3267
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes
    
    trigger = {
    	FROM = { is_alive = yes }
    	is_sufi_member_trigger = yes
    }

    option = { # This should be preserved
        name = EVTOPTA_SUFI_3267

        if = {
        	limit = {
				OR = {
					has_opinion_modifier = { who = FROM modifier = opinion_budding_friendship }
					reverse_has_opinion_modifier = { who = FROM modifier = opinion_budding_friendship }
					reverse_opinion = { who = FROM value = 50 }
					opinion = { who = FROM value = 50 }
				}
        	}
        	add_friend = FROM
        	break = yes
        }
        if = {
        	limit = { NOT = { is_friend = FROM } }
	        opinion = {
	            who = FROM
	            modifier = opinion_budding_friendship
	            years = 10
	        }
	        reverse_opinion = {
	            who = FROM
	            modifier = opinion_budding_friendship
	            years = 10
	        }
        }
        hidden_effect = { character_event = { id = SUFI.3270 } } #clean up
    }
}

# The writer's reaction 3 - THEIR WRITING SAVED YOU FROM DEPRESSION
character_event = {
    id = SUFI.3268
    desc = EVTDESC_SUFI_3268
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes
    
    trigger = {
    	FROM = { is_alive = yes }
    	is_sufi_member_trigger = yes
    }

    option = { # This saved me
        name = EVTOPTA_SUFI_3268
        custom_tooltip = { text = EVTOPTA_SUFI_3268_TT }        

        if = {
        	limit = { NOT = { is_friend = FROM } }
	        opinion = {
	            who = FROM
	            modifier = opinion_budding_friendship
	            years = 10
	        }
	        reverse_opinion = {
	            who = FROM
	            modifier = opinion_budding_friendship
	            years = 10
	        }
        }
        hidden_effect = { character_event = { id = SUFI.3270 } } #clean up
    }
}

# The writer's reaction - YOU STOLE THEIR WORK
character_event = {
    id = SUFI.3269
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes
    
    trigger = {
    	FROM = { is_alive = yes }
    	is_sufi_member_trigger = yes
    }

	desc = {
		trigger = { has_character_flag = suggestion_A_flag }
		text = EVTDESC_SUFI_3269_A
    }
    desc = {
        trigger = { has_character_flag = suggestion_B_flag }
        text = EVTDESC_SUFI_3269_B
    }

    option = { # tough luck
        name = EVTOPTA_SUFI_3269
        custom_tooltip = { text = EVTOPTA_SUFI_3269_TT }

        reverse_opinion = {
            who = FROM
            modifier = opinion_betrayed
            years = 25
        }

        if = {
        	limit = {
        		NOT = { is_friend = FROM }
        		NOT = { is_rival = FROM }
        	}
        	random = {
	            chance = 25 
	            add_rival = FROM
	        }
        }
		if = {
			limit = {
				is_friend = FROM
        	}
        	remove_friend = FROM
        }
        hidden_effect = { character_event = { id = SUFI.3270 } } #clean up
    }
}

character_event = { #clean up event
    id = SUFI.3270
    is_triggered_only = yes
    hide_window = yes

    immediate = {
    	clr_character_flag = suggestion_A_flag
    	clr_character_flag = suggestion_B_flag
		clr_character_flag = 3264_publish_flag
		clr_character_flag = 3264_preserve_flag
		clr_character_flag = 3264_depressed_flag
		clr_character_flag = 3264_depressed_flag
    }
}

#######################################################
################## 4200 - Gardening ###################
#######################################################

character_event = {
    id = SUFI.4200
    hide_window = yes
    
    is_triggered_only = yes
    only_capable = yes
    is_in_society = yes
	religion_group = muslim

    trigger = {
    	is_sufi_member_trigger = yes

    	NOT = { has_character_modifier = gardening_cooldown_timer }

    	society = {
		    any_society_member = {
	            ai = yes
	            is_incapable = no
	            prisoner = no
	            in_command = no
	            is_inaccessible_trigger = no
	            OR = {
					trait = gardener
					learning = 15
	            }
	            NOT = { character = ROOT }
	            is_within_diplo_range = ROOT
	        }
	    }	
    }
       
    immediate = {
        # First look for someone at court
        society = {
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
                    OR = {
						trait = gardener
						learning = 15
		            }
                    NOT = { character = ROOT }
                    host = { character = ROOT }
                }
                character_event = { id = SUFI.4201 }
                break = yes
            }
            
            # Then look for someone in the same realm
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
                    OR = {
						trait = gardener
						learning = 15
						diplomacy = 15
		            }
                    NOT = { character = ROOT }
                    same_realm = yes
                }
                character_event = { id = SUFI.4201 }
                break = yes
            }
            
            # Then look abroad...
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
                    OR = {
						trait = gardener
						learning = 15
		            }
                    NOT = { character = ROOT }
                    is_within_diplo_range = ROOT
                }
                character_event = { id = SUFI.4201 }
                break = yes
            }
        }
	    add_character_modifier = {
			name = gardening_cooldown_timer
			hidden = yes
			days = 1825
		}
    }
}

#Ping event for other member (the botanist)
character_event = {
    id = SUFI.4201
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { character_event = { id = SUFI.4202 } } }
}

#Fellow member asks if you want to check out their roses
character_event = {
    id = SUFI.4202
    desc = EVTDESC_SUFI_4202
    picture = GFX_evt_muslim_talk
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    option = { #Go to the monastery/ashram
        name = EVTOPTA_SUFI_4202
        custom_tooltip = { text = EVTOPTA_SUFI_4202_TT }

        set_character_flag = 4202_visit_monastery_flag
    }
    option = { #Pay someone to acquire the roses
        name = EVTOPTB_SUFI_4202
        custom_tooltip = { text = EVTOPTB_SUFI_4202_TT }
        set_character_flag = 4202_hire_someone_flag
    }
    option = { # Send sample from my own garden
    	name = EVTOPTC_SUFI_4202
    	custom_tooltip = { text = EVTOPTC_SUFI_4202_TT }
    	set_character_flag = 4202_send_my_own_samples_flag

		tooltip_info = gardener
		trigger = { trait = gardener }
    }
	option = {# do nothing
    	name = EVTOPTD_SUFI_4202
    	#custom_tooltip = { text = EVTOPTD_SUFI_4202_TT }
    }
    after = {
    	FROM = { character_event = { id = SUFI.4203 days = 15 random = 30 } }
    }
}

#Ping event for other member (the botanist)
character_event = {
    id = SUFI.4203
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = {
	    	trigger_switch = { # which event to send
	            on_trigger = has_character_flag
	            4202_visit_monastery_flag = {
	                character_event = { id = SUFI.4204 }
	                clr_character_flag = 4202_visit_monastery_flag
	            }
	            4202_hire_someone_flag = {
	                character_event = { id = SUFI.4205 }
	                clr_character_flag = 4202_hire_someone_flag
	            }
	            4202_send_my_own_samples_flag = {
			    	character_event = { id = SUFI.4206 }
	                clr_character_flag = 4202_send_my_own_samples_flag
	            }
	        }
        }
    }
}

#Visited the monastery
character_event = {
    id = SUFI.4204
    desc = EVTDESC_SUFI_4204
    picture = GFX_evt_garden
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    trigger = {
		is_sufi_member_trigger = yes
		NAND = {
			has_character_modifier = green_fingers
			has_character_modifier = dirty_hands
		}
	}

    option = { # It's like coming home
        name = EVTOPTA_SUFI_4204

        custom_tooltip = { text = EVTOPTA_SUFI_4204_TT }

        if = {
        	limit = { has_character_modifier = green_fingers }
        	add_trait = gardener
        }
        trigger = {
        	NOT = { lifestyle_traits = 1 }
        	NOT = { trait = gardener }
        	has_character_modifier = green_fingers
		}
    }

    option = { # Embrace this new interest
        name = EVTOPTB_SUFI_4204
        custom_tooltip = { text = EVTOPTB_SUFI_4204_TT }
        random_list = {
        	60 = {
        		modifier = {
        			factor = 10
        			trait = gardener
        		}
        		modifier = {
        			factor = 1.2
        			trait = diligent
        		}
        		modifier = {
        			factor = 1.1
        			learning = 12
        		}
        		add_character_modifier = {
		        	name = green_fingers
		        	years = 10
				}
        	}
        	40 = {
        		modifier = {
        			factor = 10
        			trait = imbecile
        		}
        		modifier = {
        			factor = 0.5
        			trait = genius
        		}
		        add_character_modifier = {
		        	name = dirty_hands
		        	years = 5
				}
        	}
        }
    }

    option = { # Praise the botanist
    	name = EVTOPTC_SUFI_4204
    	custom_tooltip = { text = EVTOPTC_SUFI_4204_TT }

    	reverse_opinion = {
            who = FROM
            modifier = opinion_was_praised
            years = 10
        }
    }
}

#I hired someone who brought me roses
character_event = {
    id = SUFI.4205
    desc = EVTDESC_SUFI_4205
    picture = GFX_evt_garden
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    trigger = { is_sufi_member_trigger = yes }

    option = { # Praise the botanist
    	name = EVTOPTA_SUFI_4205
    	custom_tooltip = { text = EVTOPTA_SUFI_4205_TT }

    	add_character_modifier = {
        	name = rose_gardens
        	years = 15
		}

    	reverse_opinion = {
            who = FROM
            modifier = opinion_was_praised
            years = 10
        }
    }
}

#I sent some of my own flowers to the botanist
character_event = {
    id = SUFI.4206
    desc = EVTDESC_SUFI_4206
    picture = GFX_evt_garden
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    trigger = { is_sufi_member_trigger = yes }

    option = { # I am happy to help
    	name = EVTOPTA_SUFI_4206
    	custom_tooltip = { text = EVTOPTA_SUFI_4206_TT }

		add_character_modifier = {
			name = the_name_of_the_rose
			years = 10
		}

    	reverse_opinion = {
            who = FROM
            modifier = opinion_was_praised
            years = 10
        }
    }
}


#######################################################
############ 4210 - Someone falls asleep ##############
#######################################################

character_event = { #Hidden start
    id = SUFI.4210
    hide_window = yes
    
    is_triggered_only = yes
    only_capable = yes
    is_in_society = yes
	religion_group = muslim
	
    trigger = {
    	is_sufi_member_trigger = yes

    	NOT = { has_character_modifier = fell_asleep_in_church_cooldown_timer }

    	society = {
		    any_society_member = {
	            ai = yes
	            is_incapable = no
	            prisoner = no
	            in_command = no
	            is_inaccessible_trigger = no
	            has_vice_trigger = yes
	            NOT = { character = ROOT }
	            is_within_diplo_range = ROOT
	        }
	    }	
    }
       
    immediate = {
        # First look for someone at court
        society = {
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
					has_vice_trigger = yes
                    NOT = { character = ROOT }
                    host = { character = ROOT }
                }
                character_event = { id = SUFI.4211 }
                break = yes
            }
            
            # Then look for someone in the same realm
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
                    has_vice_trigger = yes
                    NOT = { character = ROOT }
                    same_realm = yes
                }
                character_event = { id = SUFI.4211 }
                break = yes
            }
            
            # Then look abroad...
            random_society_member = {
                limit = {
                    ai = yes
                    is_incapable = no
                    prisoner = no
                    in_command = no
                    is_inaccessible_trigger = no
                    has_vice_trigger = yes
                    NOT = { character = ROOT }
                    is_within_diplo_range = ROOT
                }
                character_event = { id = SUFI.4211 }
                break = yes
            }
        }
	    add_character_modifier = {
			name = fell_asleep_in_church_cooldown_timer
			hidden = yes
			days = 1825
		}
    }
}


#Ping event for other member (the sleeper)
character_event = {
    id = SUFI.4211
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { character_event = { id = SUFI.4212 } } }
}

#Fellow member is snoring in temple
character_event = {
    id = SUFI.4212
    desc = EVTDESC_SUFI_4212
    picture = GFX_evt_muslim_talk_table
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    option = { #Wake them up
        name = EVTOPTA_SUFI_4212
        set_character_flag = 4212_woke_them_up_flag
    }
    option = { #Let them sleep
        name = EVTOPTB_SUFI_4212
        set_character_flag = 4212_let_them_sleep_flag
    }
    option = { # Prank
    	name = EVTOPTC_SUFI_4212
    	set_character_flag = 4212_pranked_them_flag

		tooltip_info = lunatic
		trigger = { trait = lunatic }
    }

    after = {
    	FROM = { character_event = { id = SUFI.4213 days = 1 } }
    }
}

#Ping event for other member (the sleeper)
character_event = {
    id = SUFI.4213
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = {
	    	trigger_switch = { # which event to send
	            on_trigger = has_character_flag
	            4212_woke_them_up_flag = {
	                character_event = { id = SUFI.4214 }
	                clr_character_flag = 4212_woke_them_up_flag
	            }
	            4212_let_them_sleep_flag = {
	                character_event = { id = SUFI.4215 }
	                clr_character_flag = 4212_let_them_sleep_flag
	            }
	            4212_pranked_them_flag = {
			    	character_event = { id = SUFI.4216 }
	                clr_character_flag = 4212_pranked_them_flag
	            }
	        }
        }
    }
}

# Woke them up
character_event = {
    id = SUFI.4214
    desc = EVTDESC_SUFI_4214
    picture = GFX_evt_muslim_talk_table
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    option = { # Think nothing of it, friend
        name = EVTOPTA_SUFI_4214
	
    	reverse_opinion = {
            who = FROM
            modifier = opinion_grateful
            years = 10
        }
    }

    option = { # Insinuate that they owe you
        name = EVTOPTB_SUFI_4214
        if = {
			limit = {
				has_dlc = "Conclave"
			}
			add_favor = FROM
		}
		trigger = {
			has_dlc = "Conclave"
		}
    }
}

# I let them sleep
character_event = {
    id = SUFI.4215
    desc = EVTDESC_SUFI_4215
    picture = GFX_evt_muslim_talk_table
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    option = { # They are embarrassed
    	name = EVTOPTA_SUFI_4215

    	FROM = {
	    	add_character_modifier = {
	        	name = embarrassed_believer
	        	years = 5
			}
    	}
    }
}

#I pranked them
character_event = {
    id = SUFI.4216
    desc = EVTDESC_SUFI_4216
    picture = GFX_evt_muslim_buly
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes

    option = { # Amazing
    	name = EVTOPTA_SUFI_4216

    	reverse_opinion = {
            who = FROM
            modifier = opinion_insulted
            years = 10
        }
    }
}
################ Burn book chain
#I own heretical books!
character_event = {
    id = SUFI.4217
    title = EVTTITLE_SUFI_4217
    desc = EVTDESC_SUFI_4217
    picture = GFX_evt_muslim_talk_table
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes
    only_capable = yes
	religion_group = muslim
	
    trigger = {
    	is_sufi_member_trigger = yes
		any_artifact = {
			AND = {
				OR = {
					has_artifact_flag = unholy
					has_artifact_flag = hermetics
				}
				has_artifact_flag = book
			}
		}
    }

    weight_multiplier = {
		factor = 1
		modifier = {
			factor = 2.0
			society_rank >= 3
		}
		modifier = {
			factor = 0.1
			has_character_flag = considered_burning_heretical_books
		}
	}

    immediate = {
    	random_artifact = {
			limit = {
				has_artifact_flag = book
				OR = {
					has_artifact_flag = unholy
					has_artifact_flag = hermetics
				}
			}
			set_artifact_flag = selected_book
		}
    }

    option = { # Amazing. Burn that baby.
    	name = {
    		text = EVTOPTA_SUFI_4217
    		trigger = {
    			NOT = { trait = zealous }
    		}
    	}
    	name = {
    		text = EVTOPTA_SUFI_4217_zealous
    		trigger = {
    			trait = zealous
    		}
    	}

    	hidden_effect = { #Checks if you're about to burn the Necronomicon...
    		if = {
    			limit = {
    				any_artifact = {
    					has_artifact_flag = selected_book
    					artifact_type = necronomicon
    				}
    			}
				set_character_flag = burned_unholy_books
				character_event = { id = SUFI.4218 days = 100 random = 365 }
    		}
    	}

    	random_artifact = { #destroys a book...
			limit = {
				has_artifact_flag = selected_book
			}
			destroy_artifact = yes
		}

		prestige = 50
		if = {
			limit = {
				any_owned_bloodline = {
					has_bloodline_flag = monastic_saintly_bloodline
				}
			}
			add_society_currency_major_effect = yes
		}
		else = {
			add_society_currency_medium_effect = yes			
		}
    }

    option = { # I shall burn ALL the books... (only available if you have more than one book)
    	name = EVTOPTB_SUFI_4217

    	name = {
    		text = EVTOPTB_SUFI_4217
    		trigger = {
    			NOT = { trait = zealous }
    		}
    	}
    	name = {
    		text = EVTOPTB_SUFI_4217_zealous
    		trigger = {
    			trait = zealous
    		}
    	}

    	hidden_effect = { #If you burn the Necronomicon...
    		if = {
    			limit = {
    				any_artifact = {
    					artifact_type = necronomicon
    				}
    			}
				set_character_flag = burned_unholy_books
				character_event = { id = SUFI.4218 days = 100 random = 365 }
    		}
    	}

    	any_artifact = { #Burns any 'unholy' book...
			limit = {
				AND = {
					OR = {
						has_artifact_flag = unholy
						has_artifact_flag = hermetics
					}
					has_artifact_flag = book
				}
			}
			destroy_artifact = yes
		}


		prestige = 100
		if = {
			limit = {
				any_owned_bloodline = {
					has_bloodline_flag = monastic_saintly_bloodline
				}
			}
			add_society_currency_large_effect = yes
		}
		else = {
			add_society_currency_major_effect = yes			
		}

		trigger = {
			any_artifact = {
				count = 2
				OR = {
					has_artifact_flag = unholy
					has_artifact_flag = hermetics
				}
				has_artifact_flag = book
			}
		}
    }

    option = { # This sounds excessive!
    	name = {
    		text = EVTOPTC_SUFI_4217
    		trigger = {
    			has_lifestyle_learning_trigger = no
    		}
    	}
    	name = {
    		text = EVTOPTC_SUFI_4217_scholar
    		trigger = {
    			has_lifestyle_learning_trigger = yes
    		}
    	}
		set_character_flag = considered_burning_heretical_books
    }

    after = {
    	any_artifact = {
    		clr_artifact_flag = selected_book
    	}
    }
}

#The Necronomicon comes back
character_event = {
    id = SUFI.4218
    title = EVTTITLE_SUFI_4218
    desc = EVTDESC_SUFI_4218
    picture = GFX_evt_ritual_scroll
    border = GFX_event_normal_frame_religion
    is_triggered_only = yes
    
    trigger = {
    	has_character_flag = burned_unholy_books
    	NOT = {
    		any_artifact = {
    			artifact_type = necronomicon
    		}
    	}
    }

    immediate = {
    	add_artifact = necronomicon
    }

    option = {      
        name = EVTOPTA_SUFI_4218
        custom_tooltip = { text = EVTOPTA_SUFI_4218_TT }

        random_artifact = { #destroys the book...
			limit = {
				artifact_type = necronomicon
			}
			destroy_artifact = yes
		}
    }
    option = {      
        name = EVTOPTB_SUFI_4218
        custom_tooltip = { text = EVTOPTB_SUFI_4218_TT }
    }
}

### Monastic Order Child Education Power ###
## 2.8 addition by Matthew Clohessy

character_event = {
	id = SUFI.4300

	is_triggered_only = yes #triggered from on_childhood_pulse
	hide_window = yes

	trigger = { 
		educator = { 
			is_sufi_member_trigger = yes
		}
		NOT = { check_variable = { which = "monastic_order_education_event" value = 3 } }
	}

	immediate = {
		change_variable = { which = "monastic_order_education_event" value = 1 }
		random = {
			chance = 30
			educator = { character_event = { id = SUFI.4301 days = 5 } }
		}
	}
}
#How do you try and nudge your ward
character_event = {
	id = SUFI.4301
	desc = {
		text = EVT_DESCA_SUFI_4301
		picture = GFX_evt_muslim_child_book
		trigger = { 
			FROM = {
				age = 6
				NOT = { age = 8 }
			}
		}
	}
	desc = {
		text = EVT_DESCB_SUFI_4301
		picture = GFX_evt_charity
		trigger = {
			FROM = {
				age = 8
				NOT = { age = 10 }
			}
		}
	}
	desc = {
		text = EVT_DESCC_SUFI_4301
		picture = GFX_evt_muslim_market_mosque
		trigger = {
			FROM = {
				age = 10
			}
		}
	}
	picture = GFX_evt_muslim_child_book
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		if = { #If no stat over 8 no extra bonues
			limit = {
				NOR = {
					diplomacy = 8
					martial = 8
					stewardship = 8
					intrigue = 8
				}
			}
			set_character_flag = monastic_order_education_learning
			break = yes
		}
		#Else mark a random stat over 8
		random_list = {
			1 = {
				trigger = { diplomacy = 8 }
				set_character_flag = monastic_order_education_diplomacy
			}
			1 = {
				trigger = { martial = 8 }
				set_character_flag = monastic_order_education_martial
			}
			1 = {
				trigger = { stewardship = 8 }
				set_character_flag = monastic_order_education_stewardship
			}
			1 = {
				trigger = { intrigue = 8 }
				set_character_flag = monastic_order_education_intrigue
			}
		}
	}

	option = { #No other stat bonus
		name = EVT_OPTA_SUFI_4301
		trigger = { has_character_flag = monastic_order_education_learning }
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 3
				}
			}
		}
	}
	option = { #Diplomacy
		name = EVT_OPTA_SUFI_4301
		trigger = { has_character_flag = monastic_order_education_diplomacy }
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 3
				}
			}
		}
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_diplomacy = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_diplomacy = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_diplomacy = 3
				}
			}
		}
	}
	option = { #Martial
		name = EVT_OPTA_SUFI_4301
		trigger = { has_character_flag = monastic_order_education_martial }
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 3
				}
			}
		}
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_martial = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_martial = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_martial = 3
				}
			}
		}
	}
	option = { #Stewardship
		name = EVT_OPTA_SUFI_4301
		trigger = { has_character_flag = monastic_order_education_stewardship }
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 3
				}
			}
		}
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_stewardship = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_stewardship = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_stewardship = 3
				}
			}
		}
	}
	option = { #Intrigue
		name = EVT_OPTA_SUFI_4301
		trigger = { has_character_flag = monastic_order_education_intrigue }
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_learning = 3
				}
			}
		}
		random_list = {
			30 = {
				modifier = {
					factor = 0.9
					is_learned_trigger = yes
				}
				FROM = {
					change_intrigue = 1
				}
			}
			50 = {
				modifier = {
					factor = 0.5
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_intrigue = 2
				}
			}
			20 = {
				modifier = {
					factor = 0
					FROM = { is_dumb_trigger = yes }
				}
				modifier = {
					factor = 2
					FROM = { is_smart_trigger = yes }
				}
				modifier = {
					factor = 1.1
					learning = 12
				}
				modifier = {
					factor = 1.1
					learning = 14
				}
				modifier = {
					factor = 1.1
					learning = 16
				}
				modifier = {
					factor = 1.1
					learning = 18
				}
				modifier = {
					factor = 1.1
					learning = 20
				}
				modifier = {
					factor = 2
					is_learned_trigger = yes
				}
				FROM = {
					change_intrigue = 3
				}
			}
		}
	}
	after = {
		clr_character_flag = monastic_order_education_learning
		clr_character_flag = monastic_order_education_diplomacy
		clr_character_flag = monastic_order_education_martial
		clr_character_flag = monastic_order_education_stewardship
		clr_character_flag = monastic_order_education_intrigue
	}
}
#Child educated by a MO member reaches adulthood
character_event = {
	id = SUFI.4302

	is_triggered_only = yes #triggered from some on_adulthood
	hide_window = yes

	trigger = { 
		educator = { 
			is_sufi_member_trigger = yes
		}
	}

	fail_trigger_effect = {
		#Clear the variable for students who temporarily were ward to an MO member
		set_variable = { which = "monastic_order_education_event" value = 0 }
	}

	immediate = {
		set_variable = { which = "monastic_order_education_event" value = 0 } #set variable to zero to prune from saves
		random = {
			chance = 30
			educator = { character_event = { id = SUFI.4303 days = 5 } }
		}
	}
}
#Educator can try to sway their former student to be better
character_event = {
	id = SUFI.4303
	desc = EVT_DESC_SUFI_4303
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	trigger = {
		is_sufi_member_trigger = yes
	}

	immediate = {
		FROM = {
			random_list = {
				1 = {
					trigger = { 
						trait = lustful
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_lustful
				}
				1 = {
					trigger = {  
						trait = gluttonous 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_gluttonous
				}
				1 = {
					trigger = {  
						trait = greedy 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_greedy
				}
				1 = {
					trigger = {  
						trait = slothful 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_slothful
				}
				1 = {
					trigger = {  
						trait = envious 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_envious
				}
				1 = {
					trigger = {  
						trait = wroth 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_wroth
				}
				1 = {
					trigger = {  
						trait = proud 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_proud
				}
				1 = {
					trigger = {  
						trait = deceitful 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_deceitful
				}
				1 = {
					trigger = {  
						trait = cruel 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_cruel
				}
				1 = {
					trigger = {  
						trait = cynical 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_remove_cynical
				}
				1 = {
					trigger = {  
						trait = ambitious 
						ROOT = { society_rank = 3 }
					}
					set_character_flag = monastic_order_education_remove_ambitious
				}
				1 = {
					trigger = {  
						NOT = { trait = humble } 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_add_humble
				}
				1 = {
					trigger = {  
						NOT = { trait = charitable } 
						ROOT = { society_rank = 1 }
					}
					set_character_flag = monastic_order_education_add_charitable
				}
				1 = {
					trigger = {  
						NOT = { trait = kind } 
						ROOT = { society_rank = 2 }
					}
					set_character_flag = monastic_order_education_add_kind
				}
				1 = {
					trigger = {  
						NOT = { trait = temperate } 
						ROOT = { society_rank = 2 }
					}
					set_character_flag = monastic_order_education_add_temperate
				}
				1 = {
					trigger = {  
						NOT = { trait = patient }
						ROOT = { society_rank = 3 }
					 }
					set_character_flag = monastic_order_education_add_patient
				}
				1 = {
					trigger = { 
						NOT = { trait = diligent } 
						ROOT = { society_rank = 3 }
					}
					set_character_flag = monastic_order_education_add_diligent
				}
				1 = {
					trigger = {  
						NOT = { trait = honest } 
						ROOT = { society_rank = 2 }
					}
					set_character_flag = monastic_order_education_add_honest
				}
				1 = {
					trigger = {  
						NOT = { trait = content } 
						ROOT = { society_rank = 3 }
					}
					set_character_flag = monastic_order_education_add_content
				}
			}
		}
	}
	
	option = {
		name = EVT_OPTA_SUFI_43003
		FROM = { character_event = { id = SUFI.4304 days = 1 } }
	}
}
#Your Monastic Order educator convinces you to be better
character_event = {
	id = SUFI.4304
	desc = EVT_DESC_SUFI_4304
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { #Sounds good
		name = EVT_OPTA_SUFI_4304
		trigger_switch = {
			on_trigger = has_character_flag
			monastic_order_education_remove_lustful		= { remove_trait = lustful }
			monastic_order_education_remove_gluttonous	= { remove_trait = gluttonous }
			monastic_order_education_remove_greedy		= { remove_trait = greedy }
			monastic_order_education_remove_slothful	= { remove_trait = slothful }
			monastic_order_education_remove_envious		= { remove_trait = envious }
			monastic_order_education_remove_wroth		= { remove_trait = wroth }
			monastic_order_education_remove_proud		= { remove_trait = proud }
			monastic_order_education_remove_deceitful   = { remove_trait = deceitful }
			monastic_order_education_remove_cruel		= { remove_trait = cruel }
			monastic_order_education_remove_cynical		= { remove_trait = cynical }
			monastic_order_education_remove_ambitious	= { remove_trait = ambitious }
			monastic_order_education_add_humble			= { add_trait = humble }
			monastic_order_education_add_charitable		= { add_trait = charitable }
			monastic_order_education_add_kind			= { add_trait = kind }
			monastic_order_education_add_temperate		= { add_trait = temperate }
			monastic_order_education_add_patient		= { add_trait = patient }
			monastic_order_education_add_diligent		= { add_trait = diligent }
			monastic_order_education_add_honest			= { add_trait = honest }
			monastic_order_education_add_content		= { add_trait = content }
		}
		FROM = { character_event = { id = SUFI.4305 days = 1 } }
	}
	option = { #No thanks I like my sins
		name = EVT_OPTB_SUFI_4304
		trigger = { ai = no }
		piety = -10
		prestige = 20
		FROM = { character_event = { id = SUFI.4306 days = 1 } }
	}
}
#Your ward did as you asked
character_event = {
	id = SUFI.4305
	desc = EVT_DESC_SUFI_4305
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVT_OPTA_SUFI_4305
		piety = 10
		FROM = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_character_flag
				monastic_order_education_remove_lustful		= { remove_trait = lustful }
				monastic_order_education_remove_gluttonous	= { remove_trait = gluttonous }
				monastic_order_education_remove_greedy		= { remove_trait = greedy }
				monastic_order_education_remove_slothful	= { remove_trait = slothful }
				monastic_order_education_remove_envious		= { remove_trait = envious }
				monastic_order_education_remove_wroth		= { remove_trait = wroth }
				monastic_order_education_remove_proud		= { remove_trait = proud }
				monastic_order_education_remove_deceitful   = { remove_trait = deceitful }
				monastic_order_education_remove_cruel		= { remove_trait = cruel }
				monastic_order_education_remove_cynical		= { remove_trait = cynical }
				monastic_order_education_remove_ambitious	= { remove_trait = ambitious }
				monastic_order_education_add_humble			= { add_trait = humble }
				monastic_order_education_add_charitable		= { add_trait = charitable }
				monastic_order_education_add_kind			= { add_trait = kind }
				monastic_order_education_add_temperate		= { add_trait = temperate }
				monastic_order_education_add_patient		= { add_trait = patient }
				monastic_order_education_add_diligent		= { add_trait = diligent }
				monastic_order_education_add_honest			= { add_trait = honest }
				monastic_order_education_add_content		= { add_trait = content }
			}
			clr_character_flag = monastic_order_education_remove_lustful
			clr_character_flag = monastic_order_education_remove_gluttonous
			clr_character_flag = monastic_order_education_remove_greedy
			clr_character_flag = monastic_order_education_remove_slothful
			clr_character_flag = monastic_order_education_remove_envious
			clr_character_flag = monastic_order_education_remove_wroth
			clr_character_flag = monastic_order_education_remove_proud
			clr_character_flag = monastic_order_education_remove_deceitful
			clr_character_flag = monastic_order_education_remove_cruel
			clr_character_flag = monastic_order_education_remove_cynical
			clr_character_flag = monastic_order_education_remove_ambitious
			clr_character_flag = monastic_order_education_add_humble
			clr_character_flag = monastic_order_education_add_charitable
			clr_character_flag = monastic_order_education_add_kind
			clr_character_flag = monastic_order_education_add_temperate
			clr_character_flag = monastic_order_education_add_patient
			clr_character_flag = monastic_order_education_add_diligent
			clr_character_flag = monastic_order_education_add_honest
			clr_character_flag = monastic_order_education_add_content
		}
	}
}
#Your ward ignored you
character_event = {
	id = SUFI.4306
	desc = EVT_DESC_SUFI_4306
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVT_OPTA_SUFI_4306
		piety = -10
		FROM = {
			clr_character_flag = monastic_order_education_remove_lustful
			clr_character_flag = monastic_order_education_remove_gluttonous
			clr_character_flag = monastic_order_education_remove_greedy
			clr_character_flag = monastic_order_education_remove_slothful
			clr_character_flag = monastic_order_education_remove_envious
			clr_character_flag = monastic_order_education_remove_wroth
			clr_character_flag = monastic_order_education_remove_proud
			clr_character_flag = monastic_order_education_remove_deceitful
			clr_character_flag = monastic_order_education_remove_cruel
			clr_character_flag = monastic_order_education_remove_cynical
			clr_character_flag = monastic_order_education_remove_ambitious
			clr_character_flag = monastic_order_education_add_humble
			clr_character_flag = monastic_order_education_add_charitable
			clr_character_flag = monastic_order_education_add_kind
			clr_character_flag = monastic_order_education_add_temperate
			clr_character_flag = monastic_order_education_add_patient
			clr_character_flag = monastic_order_education_add_diligent
			clr_character_flag = monastic_order_education_add_honest
			clr_character_flag = monastic_order_education_add_content
		}
	}
}

#Recreation
narrative_event = { #sunni
	id = SUFI.25027
	title = EVTTITLESUFI25027
	desc = EVTDESCSUFI25027
	hide_from = yes
	hide_new = yes

	picture = GFX_evt_imam
	
	only_playable = yes
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTASUFI25027
		trigger = {
			OR = { 
				society_member_of = monastic_order_sunni 
				has_sufi_societies_religion_sunni = yes
				can_join_society = monastic_order_sunni
			}
		}
		if = {
			limit = { 
				NOT = { society_member_of = monastic_order_sunni }
				can_join_society = monastic_order_sunni
			}
			join_society = monastic_order_sunni
		}
	}
	option = {
		name = EVTOPTBSUFI25027
		trigger = {
			NOR = { 
				society_member_of = monastic_order_sunni 
				has_sufi_societies_religion_sunni = yes
			}
		}
	}
}
narrative_event = { #shiite
	id = SUFI.25028
	title = EVTTITLESUFI25028
	desc = EVTDESCSUFI25028
	hide_from = yes
	hide_new = yes

	picture = GFX_evt_imam
	
	only_playable = yes
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTASUFI25028
		trigger = {
			OR = { 
				society_member_of = monastic_order_shiite 
				has_sufi_societies_religion_shiite = yes
				can_join_society = monastic_order_shiite
			}
		}
		if = {
			limit = { 
				NOT = { society_member_of = monastic_order_shiite }
				can_join_society = monastic_order_shiite
			}
			join_society = monastic_order_shiite
		}
	}
	option = {
		name = EVTOPTBSUFI25028
		trigger = {
			NOR = { 
				society_member_of = monastic_order_shiite 
				has_sufi_societies_religion_shiite = yes
			}
		}
	}
}
narrative_event = { #ibadi
	id = SUFI.25029
	title = EVTTITLESUFI25029
	desc = EVTDESCSUFI25029
	hide_from = yes
	hide_new = yes

	picture = GFX_evt_imam
	
	only_playable = yes
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTASUFI25029
		trigger = {
			OR = { 
				society_member_of = monastic_order_ibadi 
				has_sufi_societies_religion_ibadi = yes
				can_join_society = monastic_order_ibadi
			}
		}
		if = {
			limit = { 
				NOT = { society_member_of = monastic_order_ibadi }
				can_join_society = monastic_order_ibadi
			}
			join_society = monastic_order_ibadi
		}
	}
	option = {
		name = EVTOPTBSUFI25029
		trigger = {
			NOR = { 
				society_member_of = monastic_order_ibadi 
				has_sufi_societies_religion_ibadi = yes
			}
		}
	}
}
